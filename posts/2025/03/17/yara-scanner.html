<!doctype html><html lang="en" ><head> <script async src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Cloud-Native Threat Detection: Deploying YARA for Scalable Malware Detection in EKS | by Roman Tsypuk" /><meta name="author" content="Roman Tsypuk" /><meta property="og:locale" content="en" /><meta name="description" content="YARA is a powerful tool used for pattern matching in files, primarily for malware detection and digital forensics. It enables users to create rules that define the characteristics of malicious files, making it a crucial component in cybersecurity. In this post, we’ll explore how YARA works, provide practical examples, and demonstrate how to deploy it as a service in a Kubernetes (K8s) cluster." /><meta property="og:description" content="YARA is a powerful tool used for pattern matching in files, primarily for malware detection and digital forensics. It enables users to create rules that define the characteristics of malicious files, making it a crucial component in cybersecurity. In this post, we’ll explore how YARA works, provide practical examples, and demonstrate how to deploy it as a service in a Kubernetes (K8s) cluster." /><meta property="twitter:description" content="YARA is a powerful tool used for pattern matching in files, primarily for malware detection and digital forensics. It enables users to create rules that define the characteristics of malicious files, making it a crucial component in cybersecurity. In this post, we’ll explore how YARA works, provide practical examples, and demonstrate how to deploy it as a service in a Kubernetes (K8s) cluster." /><link rel="canonical" href="https://tsypuk.github.io/posts/2025/03/17/yara-scanner.html" /><meta property="og:url" content="https://tsypuk.github.io/posts/2025/03/17/yara-scanner.html" /><meta property="og:site_name" content="Engineer’s Notes | Roman Tsypuk" /><meta property="og:image" content="https://tsypuk.github.io/images/banners/1200/hacker.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-03-17T00:00:00+02:00" /><meta name="publish_date" property="og:publish_date" content="2025-03-17T00:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tsypuk.github.io/images/banners/1200/hacker.jpg" /><meta property="twitter:title" content="Cloud-Native Threat Detection: Deploying YARA for Scalable Malware Detection in EKS | by Roman Tsypuk" /><meta name="twitter:site" content="@roman_tsypuk" /><meta name="twitter:creator" content="@roman_tsypuk" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Roman Tsypuk"},"dateModified":"2025-03-22T09:38:17+02:00","datePublished":"2025-03-17T00:00:00+02:00","description":"YARA is a powerful tool used for pattern matching in files, primarily for malware detection and digital forensics. It enables users to create rules that define the characteristics of malicious files, making it a crucial component in cybersecurity. In this post, we’ll explore how YARA works, provide practical examples, and demonstrate how to deploy it as a service in a Kubernetes (K8s) cluster.","headline":"Cloud-Native Threat Detection: Deploying YARA for Scalable Malware Detection in EKS","image":"https://tsypuk.github.io/images/banners/1200/hacker.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://tsypuk.github.io/posts/2025/03/17/yara-scanner.html"},"url":"https://tsypuk.github.io/posts/2025/03/17/yara-scanner.html"}</script><title>Cloud-Native Threat Detection: Deploying YARA for Scalable Malware Detection in EKS | Engineer's Notes</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Engineer's Notes"><meta name="application-name" content="Engineer's Notes"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/images/avatar/rtsypuk.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Engineer's Notes</a><p class="site-subtitle fst-italic mb-0">Cloud, Infrastructure, Architecture, Networking</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories.html" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags.html" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archived_posts.html" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/roman_tsypuk.html" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tsypuk" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/roman_tsypuk" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/roman-tsypuk" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['tsypuk_conf','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Cloud-Native Threat Detection: Deploying YARA for Scalable Malware Detection in EKS</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Cloud-Native Threat Detection: Deploying YARA for Scalable Malware Detection in EKS</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1742162400" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 17, 2025 </time> </span> <span> Updated <time data-ts="1742629097" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 22, 2025 </time> </span><div class="mt-3 mb-3"> <a href="/images/banners/1200/hacker.jpg" class="popup img-link preview-img shimmer"><img src="/images/banners/1200/hacker.jpg" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1031 words" > <em>5 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Cloud-Native Threat Detection: Deploying YARA for Scalable Malware Detection in EKS</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Cloud-Native Threat Detection: Deploying YARA for Scalable Malware Detection in EKS</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>YARA is a powerful tool used for pattern matching in files, primarily for malware detection and digital forensics. It enables users to create rules that define the characteristics of malicious files, making it a crucial component in cybersecurity. In this post, we’ll explore how YARA works, provide practical examples, and demonstrate how to deploy it as a service in a Kubernetes (K8s) cluster.</p><h2 id="understanding-yara-rules"><span class="me-2">Understanding YARA Rules</span><a href="#understanding-yara-rules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>YARA rules are defined using a simple but flexible syntax. Each rule consists of a name, optional metadata, string patterns, and a condition to match files. Here’s a basic example:</p><pre><code class="language-yara">rule ExampleRule {
    meta:
        description = "Detects suspicious files based on string patterns"
        author = "Your Name"
    strings:
        $malicious_string1 = "malware_signature"
        $malicious_string2 = { 6A 40 68 00 30 00 00 }
    condition:
        any of them
}
</code></pre><p>This rule looks for the presence of the string <code class="language-plaintext highlighter-rouge">malware_signature</code> or a specific byte sequence in a file.</p><p>Hackers, penetration testers, antivirus companies are exploring binaries of executable files under quarantine and know payloads that can affect the <code class="language-plaintext highlighter-rouge">serializer/deserializer</code> libraries and OS to find common patterns in such binaries. This can be sequence of bytes in specific position that have some values, etc.</p><h2 id="detecting-go-and-java-binaries"><span class="me-2">Detecting Go and Java Binaries</span><a href="#detecting-go-and-java-binaries" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>YARA can also be used to identify binaries compiled in specific programming languages. Here are rules to detect Go and Java binaries:</p><h3 id="detecting-go-binaries"><span class="me-2">Detecting Go Binaries</span><a href="#detecting-go-binaries" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Go binaries often contain specific symbols and structures. The following rule helps identify them:</p><pre><code class="language-yara">rule DetectGoBinary {
    meta:
        description = "Detects Go-compiled binaries"
        author = "Your Name"
    strings:
        $go_symbol = "go.buildid"
        $go_runtime = "runtime.main"
    condition:
        any of them
}
</code></pre><h3 id="detecting-java-binaries"><span class="me-2">Detecting Java Binaries</span><a href="#detecting-java-binaries" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Java binaries typically contain <code class="language-plaintext highlighter-rouge">.class</code> file headers and specific byte sequences.</p><p>At any <code class="language-plaintext highlighter-rouge">Java</code> versions the sources that were compiled into <code class="language-plaintext highlighter-rouge">.class</code> bytecode files, always will start with <code class="language-plaintext highlighter-rouge">0xCAFEBABE</code> hex - called <code class="language-plaintext highlighter-rouge">magic number</code>.</p><p>Here is some interesting fact and guess about why:</p><blockquote class="prompt-tip"><p>Magic number is 3405691582 (0xCAFEBABE), the guess is that (a) 32-bit magic numbers are easier to handle and more likely to be unique, Java team wanted something with the Java-coffee metaphor, and since there’s no ‘J’ or ‘V’ in hexadecimal, settled for something with CAFE in it. They figured “CAFE BABE” was sexier than something like “A FAB CAFE” or “CAFE FACE”, and definitely didn’t like the implications of “CAFE A FAD” (or worse, “A BAD CAFE”).</p></blockquote><p>To detect Java classes we can write following rule, that will inspect for this bytes:</p><pre><code class="language-yara">rule DetectJavaBinary {
    meta:
        description = "Detects Java-compiled binaries"
        author = "Your Name"
    strings:
        $java_class_header = { CA FE BA BE }
        $java_string = "java/lang/Object"
    condition:
        any of them
}
</code></pre><h3 id="detecting-pdf-binaries"><span class="me-2">Detecting PDF binaries</span><a href="#detecting-pdf-binaries" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Same way <code class="language-plaintext highlighter-rouge">pdf</code> files have identifier in binary:</p><pre><code class="language-yara">rule pdf_checker
{
  meta:
    author = "N3NU"
    description = "Checks whether or not a file is truly a PDF."
  strings:
    $start = "%PDF"
    $end = "%%EOF"
  condition:
    $start at 0 and $end
}
</code></pre><p>These rules help in identifying compiled binaries, which can be useful for analyzing executables in malware research.</p><h2 id="opensource-shared-yara-rules"><span class="me-2">OpenSource shared Yara rules</span><a href="#opensource-shared-yara-rules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Once researches have found injected portions of malware in the binary they can identify unique signature of byte sequence, chars, positions, size, and created shared rule that will instrument <code class="language-plaintext highlighter-rouge">YARA</code> about what malware and its version.</p><p>Acknowledged vulnerabilities are shared with communities and companies to update <em>anti-virus</em> bases, <em>IDs</em> (intrusion detection systems) etc.</p><p>Any person can be such searcher to identify and report the vulnerabilities.</p><p>There are multiple OS shared riles, i.e. <a href="https://github.com/Yara-Rules/rules">https://github.com/Yara-Rules/rules</a> where you can get exact rules for particular types of vulnerabilities.</p><h2 id="installing-yara"><span class="me-2">Installing YARA</span><a href="#installing-yara" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To use YARA locally, install it using:</p><h3 id="on-linux"><span class="me-2">On Linux:</span><a href="#on-linux" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt <span class="nb">install </span>yara <span class="nt">-y</span>
</pre></table></code></div></div><h3 id="on-macos"><span class="me-2">On macOS:</span><a href="#on-macos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>brew <span class="nb">install </span>yara
</pre></table></code></div></div><h2 id="scanning-files-with-yara"><span class="me-2">Scanning Files with YARA</span><a href="#scanning-files-with-yara" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Once installed, you can scan files with:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yara example_rule.yar suspicious_file.exe
</pre></table></code></div></div><p>If the rule was evaluated with pattern matching - there will be next line <code class="language-plaintext highlighter-rouge">rule name</code> nad <code class="language-plaintext highlighter-rouge">payload path</code></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>yara rules/pdf_file.yar /path_to/PowerlineLN.pdf
pdf_checker /path_to/PowerlineLN.pdf
</pre></table></code></div></div><p>To scan an entire directory:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>yara <span class="nt">-r</span> rules/example_rule.yar /path/to/directory
</pre></table></code></div></div><h2 id="deploying-yara-as-a-kubernetes-service-into-eks"><span class="me-2">Deploying YARA as a Kubernetes Service into EKS</span><a href="#deploying-yara-as-a-kubernetes-service-into-eks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To make YARA accessible as a scalable service, we can deploy it in a Kubernetes cluster using a containerized YARA scanner.</p><h3 id="step-1-create-a-docker-image-for-yara"><span class="me-2">Step 1: Create a Docker Image for YARA</span><a href="#step-1-create-a-docker-image-for-yara" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Create a <code class="language-plaintext highlighter-rouge">Dockerfile</code> with the following contents:</p><div class="language-dockerfile highlighter-rouge"><div class="code-header"> <span data-label-text="Dockerfile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> ubuntu:latest</span>
<span class="k">RUN </span>apt update <span class="o">&amp;&amp;</span> apt <span class="nb">install</span> <span class="nt">-y</span> yara
<span class="k">COPY</span><span class="s"> rules/ /rules/</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["yara", "-r", "/rules"]</span>
</pre></table></code></div></div><p>Build and push the image to a registry:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>docker build <span class="nt">-t</span> your-dockerhub-username/yara-scanner <span class="nb">.</span>
docker push your-dockerhub-username/yara-scanner
</pre></table></code></div></div><h3 id="step-2-create-a-kubernetes-deployment"><span class="me-2">Step 2: Create a Kubernetes Deployment</span><a href="#step-2-create-a-kubernetes-deployment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Create a <code class="language-plaintext highlighter-rouge">yara-deployment.yaml</code> file:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">yara-scanner</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">yara</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">yara</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">yara-scanner</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">your-dockerhub-username/yara-scanner:latest</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
</pre></table></code></div></div><p>Deploy it using:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> yara-deployment.yaml
</pre></table></code></div></div><h3 id="step-3-expose-yara-as-a-service"><span class="me-2">Step 3: Expose YARA as a Service</span><a href="#step-3-expose-yara-as-a-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Create a <code class="language-plaintext highlighter-rouge">yara-service.yaml</code> file:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">yara-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">yara</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">80</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>
</pre></table></code></div></div><p>Apply the service configuration:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> yara-service.yaml
</pre></table></code></div></div><h3 id="step-4-access-the-service"><span class="me-2">Step 4: Access the Service</span><a href="#step-4-access-the-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Find the external IP of the YARA service using:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get services yara-service
</pre></table></code></div></div><p>You can now send files for scanning via a simple API if you’ve extended the container with a REST service, or use <code class="language-plaintext highlighter-rouge">kubectl exec</code> to scan files directly.</p><h3 id="c-go-interops"><span class="me-2">C++ go interops</span><a href="#c-go-interops" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In case if <code class="language-plaintext highlighter-rouge">C++</code> or <code class="language-plaintext highlighter-rouge">go</code> libraries are used to interact with <code class="language-plaintext highlighter-rouge">yara</code> additionally <code class="language-plaintext highlighter-rouge">yara-dev</code> should be installed and application must be build with <code class="language-plaintext highlighter-rouge">CGO_EMABLED=1</code> option.</p><h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>By deploying YARA in Kubernetes, you enable scalable malware detection across multiple nodes. This setup can be extended with additional automation, such as integrating with CI/CD pipelines or security monitoring tools.</p><p>Also code can be adopted not only to perform scanning of files but any payload that is submitted by the user either it is form-based text submission or a uploaded files (images, binaries, xml, text, etc.).</p><p>Would you like to see an API wrapper for YARA in Kubernetes? Let me know in the comments! 🚀</p><h3 id="links"><span class="me-2">Links:</span><a href="#links" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="https://dmfrsecurity.com/category/100-days-of-yara/">https://dmfrsecurity.com/category/100-days-of-yara/</a><li><a href="https://github.com/VirusTotal/yara">https://github.com/VirusTotal/yara</a><li><a href="https://github.com/Yara-Rules/rules">https://github.com/Yara-Rules/rules</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/aws/">aws</a>, <a href="/categories/yara/">yara</a>, <a href="/categories/eks/">eks</a>, <a href="/categories/malware/">malware</a>, <a href="/categories/ethicalhacker/">ethicalhacker</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/yara/" class="post-tag no-text-decoration" >yara</a> <a href="/tags/eks/" class="post-tag no-text-decoration" >eks</a> <a href="/tags/malware/" class="post-tag no-text-decoration" >malware</a> <a href="/tags/ethicalhacker/" class="post-tag no-text-decoration" >ethicalhacker</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Cloud-Native%20Threat%20Detection:%20Deploying%20YARA%20for%20Scalable%20Malware%20Detection%20in%20EKS%20-%20Engineer's%20Notes&url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2025%2F03%2F17%2Fyara-scanner.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Cloud-Native%20Threat%20Detection:%20Deploying%20YARA%20for%20Scalable%20Malware%20Detection%20in%20EKS%20-%20Engineer's%20Notes&u=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2025%2F03%2F17%2Fyara-scanner.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2025%2F03%2F17%2Fyara-scanner.html&text=Cloud-Native%20Threat%20Detection:%20Deploying%20YARA%20for%20Scalable%20Malware%20Detection%20in%20EKS%20-%20Engineer's%20Notes" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2025%2F03%2F17%2Fyara-scanner.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/2025/09/26/multiagnet-n8n-bedrock.html">Orchestrating AI multi-agent infrastructure with AWS Bedrock, OpenAI and n8n</a><li class="text-truncate lh-lg"> <a href="/posts/2025/07/20/elastic-cache-vector.html">Amazon ElastiCache Redis as a Vector Embeddings Storage for Semantic Search in AWS Community Blog posts</a><li class="text-truncate lh-lg"> <a href="/posts/2025/09/17/duckdb-s3.html">Running analytics queries from your machine with Zero-BigData stack needed on top of AWS S3(compressed JSON, Parquet, csv) or other DataSources</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/02/dynamo-design.html">DynamoDB Table Design Principles - NoSQL Modeling</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/04/dynamo-one-to-many.html">DynamoDB Table Design Principles - One-To-Many Relationships in NoSQL</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/2023/03/21/xra-tracing-2.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1679407200" data-df="ll" > Mar 21, 2023 </time><h4 class="pt-0 my-2">AWS XRAY tracing. Part 2: Advanced. Querying & Grouping.</h4><div class="text-muted"><p>Abstract Welcome to the next part of our AWS X-Ray series. We’ll explore the flow of trace detection and how to specify different parameters like time ranges. Additionally, we’ll take a deep dive i...</p></div></div></a></article><article class="col"> <a href="/posts/2023/03/07/mingrammer.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1678165200" data-df="ll" > Mar 7, 2023 </time><h4 class="pt-0 my-2">Diagrams-as-a-Code DaC with Mingrammer for Public Cloud Providers and Agnostic Stacks.</h4><div class="text-muted"><p>Abstract During my analysis of open-source libraries that are suitable for rendering AWS components, in order to simplify the understanding and documenting of application architecture I discovered ...</p></div></div></a></article><article class="col"> <a href="/posts/2023/03/01/xra-tracing.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1677646800" data-df="ll" > Mar 1, 2023 </time><h4 class="pt-0 my-2">AWS XRAY tracing. Part 1: Foundational</h4><div class="text-muted"><p>Abstract Having used AWS xray for a while now, I can attest to its effectiveness as a tracing and monitoring service. It has saved me a significant amount of time, helped troubleshoot complex issu...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/2025/01/11/elastic-cache-lua.html" class="btn btn-outline-primary" aria-label="Older" ><p>Making Extremely Fast AWS Elastic Cache Redis with Lua</p></a> <a href="/posts/2025/05/02/q-developer.html" class="btn btn-outline-primary" aria-label="Newer" ><p>Amazon Q cli: developing Second Brain chrome extension for converting web-pages into obsidian-like markdown</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span> <span data-bs-toggle="tooltip" data-bs-placement="top" title="2025-09-26 20:11:52 +0300 &#013;be60bb44e6416aa69b8fd68791db025be40c523c">Build version: be60bb4</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'tsypuk/tsypuk.github.io', 'data-repo-id': 'R_kgDOIxaFiw', 'data-category': 'General', 'data-category-id': 'DIC_kwDOIxaFi84CUSfn', 'data-mapping': 'og:title', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'top', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
