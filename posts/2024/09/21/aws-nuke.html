<!doctype html><html lang="en" ><head> <script async src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="AWS-nuke controlled resources cleanup in multiple aws accounts | by Roman Tsypuk" /><meta name="author" content="Roman Tsypuk" /><meta property="og:locale" content="en" /><meta name="description" content="AWS-Nuke is an open-source tool, designed to automate the removal of AWS resources from an account. It can be used to quickly and safely delete all resources in a given AWS account, or it can be customized to delete specific types of resources based on user-defined rules." /><meta property="og:description" content="AWS-Nuke is an open-source tool, designed to automate the removal of AWS resources from an account. It can be used to quickly and safely delete all resources in a given AWS account, or it can be customized to delete specific types of resources based on user-defined rules." /><meta property="twitter:description" content="AWS-Nuke is an open-source tool, designed to automate the removal of AWS resources from an account. It can be used to quickly and safely delete all resources in a given AWS account, or it can be customized to delete specific types of resources based on user-defined rules." /><link rel="canonical" href="https://tsypuk.github.io/posts/2024/09/21/aws-nuke.html" /><meta property="og:url" content="https://tsypuk.github.io/posts/2024/09/21/aws-nuke.html" /><meta property="og:site_name" content="Engineer’s Notes | Roman Tsypuk" /><meta property="og:image" content="https://tsypuk.github.io/images/banners/1200/pexels-kelly-1179532-2382848.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-09-21T01:00:00+03:00" /><meta name="publish_date" property="og:publish_date" content="2024-09-21T01:00:00+03:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tsypuk.github.io/images/banners/1200/pexels-kelly-1179532-2382848.jpg" /><meta property="twitter:title" content="AWS-nuke controlled resources cleanup in multiple aws accounts | by Roman Tsypuk" /><meta name="twitter:site" content="@roman_tsypuk" /><meta name="twitter:creator" content="@roman_tsypuk" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Roman Tsypuk"},"dateModified":"2024-09-21T01:00:00+03:00","datePublished":"2024-09-21T01:00:00+03:00","description":"AWS-Nuke is an open-source tool, designed to automate the removal of AWS resources from an account. It can be used to quickly and safely delete all resources in a given AWS account, or it can be customized to delete specific types of resources based on user-defined rules.","headline":"AWS-nuke controlled resources cleanup in multiple aws accounts","image":"https://tsypuk.github.io/images/banners/1200/pexels-kelly-1179532-2382848.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://tsypuk.github.io/posts/2024/09/21/aws-nuke.html"},"url":"https://tsypuk.github.io/posts/2024/09/21/aws-nuke.html"}</script><title>AWS-nuke controlled resources cleanup in multiple aws accounts | Engineer's Notes</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Engineer's Notes"><meta name="application-name" content="Engineer's Notes"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/images/avatar/rtsypuk.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Engineer's Notes</a><p class="site-subtitle fst-italic mb-0">Cloud, Infrastructure, Architecture, Networking</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories.html" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags.html" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archived_posts.html" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/roman_tsypuk.html" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tsypuk" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/roman_tsypuk" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/roman-tsypuk" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['tsypuk_conf','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>AWS-nuke controlled resources cleanup in multiple aws accounts</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>AWS-nuke controlled resources cleanup in multiple aws accounts</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1726869600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 21, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/images/banners/1200/pexels-kelly-1179532-2382848.jpg" class="popup img-link preview-img shimmer"><img src="/images/banners/1200/pexels-kelly-1179532-2382848.jpg" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1600 words" > <em>8 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">AWS-nuke controlled resources cleanup in multiple aws accounts</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">AWS-nuke controlled resources cleanup in multiple aws accounts</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>AWS-Nuke is an open-source tool, designed to automate the removal of AWS resources from an account. It can be used to quickly and safely delete all resources in a given AWS account, or it can be customized to delete specific types of resources based on user-defined rules.</p><h3 id="what-is-aws-nuke"><span class="me-2">What is AWS-Nuke?</span><a href="#what-is-aws-nuke" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Whether you’re spinning up test environments or decommissioning an old project, AWS-Nuke is particularly useful for keeping AWS accounts clean, ensuring that old, unused resources do not pile up, leading to cost overruns, security risks, and unnecessary complexity.</p><p>AWS-Nuke is a command-line tool that supports multiple AWS services and can be run from any machine that has access to AWS credentials.</p><h3 id="why-use-aws-nuke"><span class="me-2">Why Use AWS-Nuke?</span><a href="#why-use-aws-nuke" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Before diving into the technical details of AWS-Nuke, it’s important to understand why this tool is useful.</p><ul><li><p>Cost Management: One of the biggest challenges in cloud environments is managing costs. AWS charges based on the resources you use, and sometimes resources that are no longer in use are forgotten and left running. By using AWS-Nuke, you can regularly clean up old resources, ensuring that you only pay for what you actively use.</p><li><p>Environment Cleanup: In development and test environments, resources are often created, modified, and left without proper deletion. AWS-Nuke can help by regularly purging these environments of unnecessary resources, making it easier to manage infrastructure.</p><li><p>Security: Resources left running for extended periods can pose security risks. For instance, unused EC2 instances, security groups, or S3 buckets might expose your environment to attacks. AWS-Nuke helps minimize such risks by cleaning up unused resources.</p><li><p>Automation: AWS-Nuke offers automation capabilities, making it easier to integrate into continuous integration (CI) pipelines or scheduled jobs for periodic account cleanups.</p><li><p>Simplification: With hundreds of AWS services and resources to manage, AWS-Nuke simplifies the task of cleaning up resources by providing a centralized and automated way to perform deletions.</p></ul><h3 id="how-aws-nuke-works"><span class="me-2">How AWS-Nuke Works</span><a href="#how-aws-nuke-works" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>AWS-Nuke works by scanning all the resources in your AWS account and then deleting them based on a configuration file. You can configure AWS-Nuke to delete specific types of resources or to leave certain critical resources untouched.</p><p>AWS-Nuke uses the AWS SDK to list and delete resources. It can handle a wide range of AWS services, including but not limited to:</p><p>EC2 Instances S3 Buckets RDS Instances IAM Users and Roles VPCs Elastic Load Balancers CloudWatch Alarms CloudFormation Stacks ECR Repositories</p><h3 id="configuration"><span class="me-2">Configuration</span><a href="#configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>AWS-Nuke uses a YAML configuration file to specify what resources should or should not be deleted. This configuration file is highly customizable, allowing users to target specific AWS resources while leaving others intact.</p><p>Here’s a simple example of an AWS-Nuke configuration:</p><p>yaml Copy code regions:</p><ul><li>“us-east-1”<li>“us-west-2”</ul><p>resource-types: excludes:</p><ul><li>EC2::KeyPair<li>IAM::Role<li>IAM::User This configuration specifies that AWS-Nuke should only run in the us-east-1 and us-west-2 regions, and it will exclude deleting EC2 Key Pairs, IAM Roles, and IAM Users.</ul><p>Dry-Run Mode One of AWS-Nuke’s most useful features is the dry-run mode, which allows users to see what resources will be deleted without actually deleting them. This is useful for reviewing the results of a cleanup before making any irreversible changes.</p><p>To run AWS-Nuke in dry-run mode, simply use the –dry-run flag:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>aws-nuke <span class="nt">--config</span> config.yml <span class="nt">--dry-run</span>
</pre></table></code></div></div><p>This command will output a list of resources that AWS-Nuke will delete based on the configuration file, without actually performing the deletions.</p><p>Running AWS-Nuke Once you’re confident in your configuration, running AWS-Nuke is simple. First, ensure you have the correct AWS credentials for the account you want to clean up. Then, use the following command:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>aws-nuke <span class="nt">--config</span> config.yml
</pre></table></code></div></div><p>This command will delete all resources in the account, except for the ones excluded in the configuration.</p><p>Resource Dependencies AWS-Nuke also handles resource dependencies. For example, it will not delete an S3 bucket until all objects within the bucket have been deleted. This ensures that AWS resources are deleted in the correct order, preventing errors and failed deletions.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>brew <span class="nb">install </span>aws-nuke
</pre></table></code></div></div><p>After checking version installed from brew repo is outdated:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre> aws-nuke <span class="nt">-c</span> config/nuke-config.yml <span class="nt">--profile</span> technology
Incorrect Usage: flag provided but not defined: <span class="nt">-c</span>

NAME:
   aws-nuke - remove everything from an aws account

USAGE:
   aws-nuke <span class="o">[</span>global options] <span class="nb">command</span> <span class="o">[</span><span class="nb">command </span>options]

VERSION:
   3.22.0

AUTHOR:
   Erik Kristensen &lt;erik@erikkristensen.com&gt;

FATA[0000] flag provided but not defined: <span class="nt">-c</span>
</pre></table></code></div></div><p>So I will use the latest version installed from sources:</p><h2 id="contributing-to-aws-nuke"><span class="me-2">Contributing to aws-nuke</span><a href="#contributing-to-aws-nuke" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When running locally aws-nuke with aws profile I got error.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>aws_nuke_v2 <span class="nt">-c</span> config/nuke-config.yaml <span class="nt">--profile</span> personal_profile
Error: failed get <span class="nb">caller </span>identity: NoCredentialProviders: no valid providers <span class="k">in </span>chain. Deprecated.
For verbose messaging see aws.Config.CredentialsChainVerboseErrors

Process finished with the <span class="nb">exit </span>code 255
</pre></table></code></div></div><p>And after checking the sources, I find out that profile is present in parameters for aws-nuke, but not implemented. So I have added this feature to aws-nuke:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">Profile</span> <span class="o">!=</span> <span class="s">""</span> <span class="p">{</span>
			<span class="n">cfg</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">awsSDKConfig</span><span class="o">.</span><span class="n">LoadDefaultConfig</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">TODO</span><span class="p">(),</span> <span class="n">awsSDKConfig</span><span class="o">.</span><span class="n">WithSharedConfigProfile</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">Profile</span><span class="p">))</span>
			<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
				<span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"unable to load SDK config, %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="n">log</span><span class="o">.</span><span class="n">Infof</span><span class="p">(</span><span class="s">"using profile %v"</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">Profile</span><span class="p">)</span>
			<span class="c">/// Extract credentials from the configuration</span>
			<span class="n">cred</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Credentials</span><span class="o">.</span><span class="n">Retrieve</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">TODO</span><span class="p">())</span>
			<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
				<span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"unable to retrieve credentials, %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="n">creds</span><span class="o">.</span><span class="n">AccessKeyID</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="n">AccessKeyID</span>
			<span class="n">creds</span><span class="o">.</span><span class="n">SecretAccessKey</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="n">SecretAccessKey</span>
			<span class="n">defaultRegion</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Region</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="o">!</span><span class="n">creds</span><span class="o">.</span><span class="n">HasKeys</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">creds</span><span class="o">.</span><span class="n">HasProfile</span><span class="p">()</span> <span class="p">{</span>
			<span class="n">creds</span><span class="o">.</span><span class="n">AccessKeyID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"AWS_ACCESS_KEY_ID"</span><span class="p">)</span>
			<span class="n">creds</span><span class="o">.</span><span class="n">SecretAccessKey</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"AWS_SECRET_ACCESS_KEY"</span><span class="p">)</span>
		<span class="p">}</span>
</pre></table></code></div></div><p>Also added Contribution PR to aws-nuke: <a href="https://github.com/rebuy-de/aws-nuke/pull/1263/files">https://github.com/rebuy-de/aws-nuke/pull/1263/files</a></p><p>Now aws-nuke correctly process –profile cli argument and is ready to run</p><h3 id="working-with-implemented-profile-feature"><span class="me-2">Working with implemented profile feature:</span><a href="#working-with-implemented-profile-feature" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">go</span> <span class="n">run</span> <span class="n">main</span><span class="o">.</span><span class="k">go</span> <span class="o">-</span><span class="n">c</span> <span class="n">config</span><span class="o">/</span><span class="n">nuke</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">profile</span> <span class="n">personal_account</span>

<span class="n">INFO</span><span class="p">[</span><span class="m">0000</span><span class="p">]</span> <span class="n">using</span> <span class="n">profile</span> <span class="n">personal_account</span>
<span class="n">aws</span><span class="o">-</span><span class="n">nuke</span> <span class="n">version</span> <span class="n">unknown</span> <span class="o">-</span> <span class="n">unknown</span> <span class="o">-</span> <span class="n">unknown</span>

<span class="n">Do</span> <span class="n">you</span> <span class="n">really</span> <span class="n">want</span> <span class="n">to</span> <span class="n">nuke</span> <span class="n">the</span> <span class="n">account</span> <span class="n">with</span> <span class="n">the</span> <span class="n">ID</span> <span class="m">123456789012</span> <span class="n">and</span> <span class="n">the</span> <span class="n">alias</span> <span class="err">'</span><span class="n">personal_account</span><span class="err">'?</span>
<span class="n">Do</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="k">continue</span><span class="err">?</span> <span class="n">Enter</span> <span class="n">account</span> <span class="n">alias</span> <span class="n">to</span> <span class="k">continue</span><span class="o">.</span>
<span class="o">&gt;</span> <span class="n">personal_account</span>
</pre></table></code></div></div><p>Tool will query existing resources, match them with filters that we have configured in exclusion and will do dry run.</p><h3 id="resources-that-we-want-to-leave-in-account"><span class="me-2">Resources that we want to leave in account</span><a href="#resources-that-we-want-to-leave-in-account" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s say we do not want to affect IAM users/permissions/policies, also MFA devices and some route53 records. These all resources should be declared in aws-nuke config, so when running it will not touch them.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="na">regions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">eu-east-1</span>
  <span class="pi">-</span> <span class="s">global</span>

<span class="na">accounts</span><span class="pi">:</span>
<span class="na">123456789012</span><span class="pi">:</span>
<span class="na">filters</span><span class="pi">:</span>
<span class="na">PolicyName</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">property</span><span class="pi">:</span> <span class="s2">"</span><span class="s">UserName"</span>
  <span class="pi">-</span> <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">aws-cli"</span>
<span class="na">IAMRole</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">OrganizationAccountAccessRole"</span>
<span class="na">IAMRolePolicyAttachment</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">OrganizationAccountAccessRole"</span>
  <span class="pi">-</span> <span class="na">property</span><span class="pi">:</span> <span class="s">arn</span>
  <span class="pi">-</span> <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">arn:aws:iam::aws:policy/AdministratorAccess"</span>
<span class="na">IAMUser</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">admin"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">aws-cli"</span>
<span class="na">IAMUserAccessKey</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">property</span><span class="pi">:</span> <span class="s">UserName</span>
<span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">aws-cli"</span>
<span class="na">IAMUserPolicyAttachment</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">property</span><span class="pi">:</span> <span class="s2">"</span><span class="s">arn"</span>
  <span class="pi">-</span> <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">arn:aws:iam::aws:policy/AdministratorAccess"</span>
<span class="na">IAMVirtualMFADevice</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">property</span><span class="pi">:</span> <span class="s">arn</span>
  <span class="pi">-</span> <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">arn:aws:iam::123456789012:mfa/to.root.iphone"</span>
<span class="na">Route53HostedZone</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">property</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Name"</span>
  <span class="pi">-</span> <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">xxxxx.xx."</span>

<span class="na">account-blocklist</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="m">1234567890</span>

<span class="na">resource-types</span><span class="pi">:</span>
<span class="na">excludes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Route53ResourceRecordSet</span>
  <span class="pi">-</span> <span class="s">Route53HostedZone</span>
</pre></table></code></div></div><h3 id="review-resources-in-output"><span class="me-2">Review resources in output</span><a href="#review-resources-in-output" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>...
global - IAMPolicy - arn:aws:iam::123456789012:policy/terraform-20230725102234859300000005 - <span class="o">[</span>ARN: <span class="s2">"arn:aws:iam::123456789012:policy/terraform-20230725102234859300000005"</span>, Name: <span class="s2">"terraform-20230725102234859300000005"</span>, Path: <span class="s2">"/"</span>, PolicyID: <span class="s2">"ANPAVFCI6B4SXG62NJLCB"</span><span class="o">]</span> - would remove

global - IAMRole - AmazonGrafanaServiceRole-Skz3Lbeo2 - <span class="o">[</span>CreateDate: <span class="s2">"2023-03-21T16:02:03Z"</span>, LastUsedDate: <span class="s2">"2023-03-21T16:02:03Z"</span>, Name: <span class="s2">"AmazonGrafanaServiceRole-Skz3Lbeo2"</span>, Path: <span class="s2">"/service-role/"</span><span class="o">]</span> - would remove

123456789012<span class="s2">", PolicyName: "</span>terraform-20230725102234859300000005<span class="s2">", RoleCreateDate: "</span>2023-07-25T10:22:27Z<span class="s2">", RoleLastUsed: "</span>2023-07-25T10:22:27Z<span class="s2">", RoleName: "</span>terraform-20230725102226616700000002<span class="s2">", RolePath: "</span>/<span class="s2">"] - filtered by config
global - IAMRolePolicy - terraform-20230725102226616700000003 -&gt; terraform-20230725102227744300000004 - [PolicyName: "</span>terraform-20230725102227744300000004<span class="s2">", role:CreateDate: "</span>2023-07-25T10:22:27Z<span class="s2">", role:LastUsed: "</span>2023-07-25T10:22:56Z<span class="s2">", role:Path: "</span>/<span class="s2">", role:RoleID: "</span>AROAVFCI6B4SWQNDRGVXF<span class="s2">", role:RoleName: "</span>terraform-20230725102226616700000003<span class="s2">"] - would remove
Scan complete: 44 total, 13 nukeable, 31 filtered.

The above resources would be deleted with the supplied configuration. Provide --no-dry-run to actually destroy resources.
</span></pre></table></code></div></div><h3 id="perform-cleanup"><span class="me-2">Perform cleanup</span><a href="#perform-cleanup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>go run main.go <span class="nt">-c</span> config/nuke-config.yaml <span class="nt">--profile</span> personal_account <span class="nt">--no-dry-run</span>

INFO[0000] using profile personal_account
aws-nuke version unknown - unknown - unknown

Do you really want to nuke the account with the ID 123456789012 and the <span class="nb">alias</span> <span class="s1">'personal_account'</span>?
Do you want to <span class="k">continue</span>? Enter account <span class="nb">alias </span>to <span class="k">continue</span><span class="nb">.</span>
<span class="o">&gt;</span> personal_account

</pre></table></code></div></div><p>First aws-nuke will scan as in dry-run, and also propose to confirm deletion.</p><p>Tool has issues deleting IAMs - it has logic to retry but does not understand resources dependencies. For instance, it can not delete role with attached policies that it also should delete:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>ERRO[0373] DeleteConflict: Cannot delete entity, must detach all policies first.
status code: 409, request id: 9506e3fd-5945-48b3-9031-826d28d2abec
</pre></table></code></div></div><p>so you have manually delete from CLI or aws console</p><h3 id="integration-with-cicd"><span class="me-2">Integration with CI/CD</span><a href="#integration-with-cicd" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>One of the best use cases for AWS-Nuke is integrating it into a CI/CD pipeline. You can use AWS-Nuke as part of your continuous integration (CI) process to clean up test environments after running tests. This ensures that no unnecessary resources remain after testing is complete, keeping your environment clean and your costs under control.</p><p>Here’s an example of how you might integrate AWS-Nuke into a CI/CD pipeline:</p><ul><li>Run AWS-Nuke in dry-run mode before deploying a new version of your application to ensure there are no unnecessary resources left over from previous tests.<li>After the deployment and testing are complete, run AWS-Nuke in full mode to clean up all resources.</ul><h3 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>AWS-Nuke is a powerful and versatile tool for cleaning up AWS environments. It helps prevent cost overruns, reduces security risks, and simplifies the management of AWS resources. Whether you’re managing a development environment, performing testing, or decommissioning an old project, AWS-Nuke provides an efficient way to automate the cleanup process.</p><p>However, AWS-Nuke also requires careful configuration to avoid deleting critical resources. Always use the dry-run mode to review deletions before making any changes, and ensure that your configuration file accurately reflects your environment.</p><p>In an age where cloud resources can grow exponentially, tools like AWS-Nuke are indispensable for keeping your infrastructure lean and efficient.</p><h3 id="links"><span class="me-2">Links:</span><a href="#links" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="https://github.com/rebuy-de/aws-nuke">https://github.com/rebuy-de/aws-nuke</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/aws/">aws</a>, <a href="/categories/dynamodb/">dynamodb</a>, <a href="/categories/naive/">naive</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/dynamodb/" class="post-tag no-text-decoration" >dynamodb</a> <a href="/tags/naive/" class="post-tag no-text-decoration" >naive</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=AWS-nuke%20controlled%20resources%20cleanup%20in%20multiple%20aws%20accounts%20-%20Engineer's%20Notes&url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2024%2F09%2F21%2Faws-nuke.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=AWS-nuke%20controlled%20resources%20cleanup%20in%20multiple%20aws%20accounts%20-%20Engineer's%20Notes&u=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2024%2F09%2F21%2Faws-nuke.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2024%2F09%2F21%2Faws-nuke.html&text=AWS-nuke%20controlled%20resources%20cleanup%20in%20multiple%20aws%20accounts%20-%20Engineer's%20Notes" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2024%2F09%2F21%2Faws-nuke.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/2025/09/26/multiagnet-n8n-bedrock.html">Orchestrating AI multi-agent infrastructure with AWS Bedrock, OpenAI and n8n</a><li class="text-truncate lh-lg"> <a href="/posts/2025/07/20/elastic-cache-vector.html">Amazon ElastiCache Redis as a Vector Embeddings Storage for Semantic Search in AWS Community Blog posts</a><li class="text-truncate lh-lg"> <a href="/posts/2025/09/17/duckdb-s3.html">Running analytics queries from your machine with Zero-BigData stack needed on top of AWS S3(compressed JSON, Parquet, csv) or other DataSources</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/02/dynamo-design.html">DynamoDB Table Design Principles - NoSQL Modeling</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/04/dynamo-one-to-many.html">DynamoDB Table Design Principles - One-To-Many Relationships in NoSQL</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/2024/09/01/dynamodb-naive-updates.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1725141600" data-df="ll" > Sep 1, 2024 </time><h4 class="pt-0 my-2">Understanding Access Patterns in DynamoDB. Part1: Why Naive Reads and Entity Updates Can Cause Multiple Problems</h4><div class="text-muted"><p>DynamoDB, AWS’s NoSQL database service, is designed for scalability and performance. However, getting the best out of DynamoDB requires a deep understanding of access patterns. Introduction A co...</p></div></div></a></article><article class="col"> <a href="/posts/2023/10/06/dynamo-filters.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1696600800" data-df="ll" > Oct 6, 2023 </time><h4 class="pt-0 my-2">DynamoDB Table Design Principles - Filtering</h4><div class="text-muted"><p>Abstract We will continue exploring different technics that allow to extend Access Patterns to a Single Table. Target DynamoDB Table Structure NoSQL DynamoDB Table Structure is generated usi...</p></div></div></a></article><article class="col"> <a href="/posts/2023/10/04/dynamo-one-to-many.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1696428000" data-df="ll" > Oct 4, 2023 </time><h4 class="pt-0 my-2">DynamoDB Table Design Principles - One-To-Many Relationships in NoSQL</h4><div class="text-muted"><p>Abstract In Relational Database we used to have single Entity per Table, build relationships between them and assign constrains like Foreign Keys. In NoSQL DynamoDB world this became an Antipatter...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/2024/09/01/dynamodb-naive-updates.html" class="btn btn-outline-primary" aria-label="Older" ><p>Understanding Access Patterns in DynamoDB. Part1: Why Naive Reads and Entity Updates Can Cause Multiple Problems</p></a> <a href="/posts/2024/10/05/aws-csm.html" class="btn btn-outline-primary" aria-label="Newer" ><p>AWS CSM Mode: Advanced monitoring of AWS client</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span> <span data-bs-toggle="tooltip" data-bs-placement="top" title="2025-09-26 20:11:52 +0300 &#013;be60bb44e6416aa69b8fd68791db025be40c523c">Build version: be60bb4</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'tsypuk/tsypuk.github.io', 'data-repo-id': 'R_kgDOIxaFiw', 'data-category': 'General', 'data-category-id': 'DIC_kwDOIxaFi84CUSfn', 'data-mapping': 'og:title', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'top', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
