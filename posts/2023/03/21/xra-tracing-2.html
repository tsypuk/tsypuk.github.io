<!doctype html><html lang="en" ><head> <script async src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="AWS XRAY tracing. Part 2: Advanced. Querying &amp; Grouping. | by Roman Tsypuk" /><meta name="author" content="Roman Tsypuk" /><meta property="og:locale" content="en" /><meta name="description" content="Welcome to the next part of our AWS X-Ray series. We’ll explore the flow of trace detection and how to specify different parameters like time ranges. Additionally, we’ll take a deep dive into the DSL of advanced querying. We’ll also examine what is sampling, how it works and how X-Ray groups can assist with operational efforts." /><meta property="og:description" content="Welcome to the next part of our AWS X-Ray series. We’ll explore the flow of trace detection and how to specify different parameters like time ranges. Additionally, we’ll take a deep dive into the DSL of advanced querying. We’ll also examine what is sampling, how it works and how X-Ray groups can assist with operational efforts." /><meta property="twitter:description" content="Welcome to the next part of our AWS X-Ray series. We’ll explore the flow of trace detection and how to specify different parameters like time ranges. Additionally, we’ll take a deep dive into the DSL of advanced querying. We’ll also examine what is sampling, how it works and how X-Ray groups can assist with operational efforts." /><link rel="canonical" href="https://tsypuk.github.io/posts/2023/03/21/xra-tracing-2.html" /><meta property="og:url" content="https://tsypuk.github.io/posts/2023/03/21/xra-tracing-2.html" /><meta property="og:site_name" content="Engineer’s Notes | Roman Tsypuk" /><meta property="og:image" content="https://tsypuk.github.io/images/banners/twitter/banner-xray-2.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-03-21T16:00:00+02:00" /><meta name="publish_date" property="og:publish_date" content="2023-03-21T16:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tsypuk.github.io/images/banners/twitter/banner-xray-2.png" /><meta property="twitter:title" content="AWS XRAY tracing. Part 2: Advanced. Querying &amp; Grouping. | by Roman Tsypuk" /><meta name="twitter:site" content="@roman_tsypuk" /><meta name="twitter:creator" content="@roman_tsypuk" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Roman Tsypuk"},"dateModified":"2024-02-25T18:38:06+02:00","datePublished":"2023-03-21T16:00:00+02:00","description":"Welcome to the next part of our AWS X-Ray series. We’ll explore the flow of trace detection and how to specify different parameters like time ranges. Additionally, we’ll take a deep dive into the DSL of advanced querying. We’ll also examine what is sampling, how it works and how X-Ray groups can assist with operational efforts.","headline":"AWS XRAY tracing. Part 2: Advanced. Querying &amp; Grouping.","image":{"twitter":"/images/banners/twitter/banner-xray-2.png","url":"https://tsypuk.github.io/images/banners/twitter/banner-xray-2.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tsypuk.github.io/posts/2023/03/21/xra-tracing-2.html"},"url":"https://tsypuk.github.io/posts/2023/03/21/xra-tracing-2.html"}</script><title>AWS XRAY tracing. Part 2: Advanced. Querying & Grouping. | Engineer's Notes</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Engineer's Notes"><meta name="application-name" content="Engineer's Notes"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/images/avatar/rtsypuk.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Engineer's Notes</a><p class="site-subtitle fst-italic mb-0">Cloud, Infrastructure, Architecture, Networking</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories.html" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags.html" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archived_posts.html" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/roman_tsypuk.html" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tsypuk" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/roman_tsypuk" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/roman-tsypuk" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['tsypuk_conf','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>AWS XRAY tracing. Part 2: Advanced. Querying & Grouping.</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>AWS XRAY tracing. Part 2: Advanced. Querying & Grouping.</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1679407200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 21, 2023 </time> </span> <span> Updated <time data-ts="1708879086" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 25, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/images/banners/1200/xray2.jpg" class="popup img-link preview-img shimmer"><img src="/images/banners/1200/xray2.jpg" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1038 words" > <em>5 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">AWS XRAY tracing. Part 2: Advanced. Querying & Grouping.</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">AWS XRAY tracing. Part 2: Advanced. Querying & Grouping.</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="abstract"><span class="me-2">Abstract</span><a href="#abstract" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Welcome to the next part of our AWS X-Ray series. We’ll explore the flow of trace detection and how to specify different parameters like time ranges. Additionally, we’ll take a deep dive into the DSL of advanced querying. We’ll also examine what is sampling, how it works and how X-Ray groups can assist with operational efforts.</p><p>Link to <a href="/posts/2023/03/01/xra-tracing.html">AWS XRAY tracing. Part 1: Foundational</a></p><p>Link to <a href="/posts/2023/03/27/xra-tracing-3.html">AWS XRAY tracing. Part 3: Sampling &amp; Billing</a></p><h2 id="accessing-traces-from-service-map"><span class="me-2">Accessing traces from Service Map</span><a href="#accessing-traces-from-service-map" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To begin the process, select a dedicated service or edge between services, set a response time range, and choose the desired statuses from the service map:</p><p><a href="/images/posts/xray2/traces_from_map.png" class="popup img-link shimmer"><img src="/images/posts/xray2/traces_from_map.png" alt="img.png" loading="lazy"></a></p><p>Once the parameters are specified, the traces will be displayed along with key information such as the trace ID, age, method, response code, response time, client IP, annotation count, and URL: <a href="/images/posts/xray2/trace_results.png" class="popup img-link shimmer"><img src="/images/posts/xray2/trace_results.png" alt="img.png" loading="lazy"></a></p><p>Pay attention to the top section - X-Ray has generated a filter expression to retrieve traces based on your previous selections. To effectively identify issues and bottlenecks, it’s important to be familiar with this DSL. We’ll explore its details later in this post.</p><p><code class="language-plaintext highlighter-rouge">service(id(name: "proto-publisher-sqs", type: "AWS::Lambda")) { responsetime &gt;= 0.172 AND responsetime &lt;= 0.366 AND ok = true }</code></p><p>Alternative way is to access traces through CloudWatch xray console that has almost same configurations:</p><p><a href="/images/posts/xray2/xray_cloudwatch.png" class="popup img-link shimmer"><img src="/images/posts/xray2/xray_cloudwatch.png" alt="img.png" loading="lazy"></a></p><p>In addition, the middle chart provides useful metrics by representing the distribution of requests in percentiles:</p><p><a href="/images/posts/xray2/traces_distribution.png" class="popup img-link shimmer"><img src="/images/posts/xray2/traces_distribution.png" alt="img_1.png" loading="lazy"></a></p><blockquote class="prompt-tip"><p>Percentile is a score below which a given percentage of scores in its frequency distribution falls (“exclusive” definition) or a score at or below which a given percentage falls (“inclusive” definition). Percentiles are expressed in the same unit of measurement as the input scores, not in percent <code class="language-plaintext highlighter-rouge">The 25th percentile</code> is also known as the <code class="language-plaintext highlighter-rouge">first quartile (Q1)</code>, the <code class="language-plaintext highlighter-rouge">50th percentile</code> as the median or <code class="language-plaintext highlighter-rouge">second quartile (Q2)</code>, and the <code class="language-plaintext highlighter-rouge">75th percentile</code> as the <code class="language-plaintext highlighter-rouge">third quartile (Q3)</code>.</p></blockquote><p>This dashboard also allows you to select the percentile range you’re interested in. For instance, if there are anomalies or spikes in performance, you can narrow down the results by selecting traces within that range for further verification. By changing the percentile range, the query will be updated and the trace results will be filtered accordingly:</p><p><a href="/images/posts/xray2/percentile.png" class="popup img-link shimmer"><img src="/images/posts/xray2/percentile.png" alt="img.png" loading="lazy"></a> <a href="/images/posts/xray2/xray_query.png" class="popup img-link shimmer"><img src="/images/posts/xray2/xray_query.png" alt="img_1.png" loading="lazy"></a></p><p><code class="language-plaintext highlighter-rouge">P50</code> the <code class="language-plaintext highlighter-rouge">50th percentile (median)</code> is the score below contains <code class="language-plaintext highlighter-rouge">50% of the requests</code> in the distribution. So from our chart we observe that 50% requests have latency less than 70ms. P95: 95% requests have latency 132ms or less.</p><p>Once we’ve selected the trace ID we’re interested in, we can navigate to the Trace and Segments detail: <a href="/images/posts/xray2/trace_details.png" class="popup img-link shimmer"><img src="/images/posts/xray2/trace_details.png" alt="img.png" loading="lazy"></a></p><p>We can observe that this flow is combined from 3 segments. This is due to there are 2 SQS inside the flow that are dividing ecosystem into 3 parts that are producers or consumers. <a href="/images/posts/xray2/linked_segment.png" class="popup img-link shimmer"><img src="/images/posts/xray2/linked_segment.png" alt="img.png" loading="lazy"></a> We can open and check the details of any linked segment with its traces to check latencies, health and interaction with internal resrouces.</p><h2 id="advanced-querying-dsl"><span class="me-2">Advanced querying DSL</span><a href="#advanced-querying-dsl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now let’s take a look in details of the DSL. There are several operational modes:</p><h3 id="edge-level-dsl-to-get-connections-between-aws-services"><span class="me-2">Edge level DSL to get connections between AWS services</span><a href="#edge-level-dsl-to-get-connections-between-aws-services" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">edge(source, destination) {filter}</code></p><p>Query all traces for flows that have interaction between <strong>proto-publisher-sns</strong> <strong>lambda function</strong> and <strong>SNS topic</strong>:</p><p><code class="language-plaintext highlighter-rouge">edge(id(name: "proto-publisher-sns", type: "AWS::Lambda::Function"), "sns-topic-proto")</code></p><p>Same edge connection with <strong>additional filtering</strong>:</p><p><code class="language-plaintext highlighter-rouge">edge(id(name: "proto-publisher-sns", type: "AWS::Lambda::Function"), "sns-topic-proto"){ok = true }</code></p><h3 id="service-level-dsl-for-traces-going-through-aws-service"><span class="me-2">Service level DSL for traces going through AWS service</span><a href="#service-level-dsl-for-traces-going-through-aws-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">service(name) {filter}</code></p><p>Query all traces of flows that are going through specified lambda function:</p><p><code class="language-plaintext highlighter-rouge">service(id(name: "proto-publisher-sqs", type: "AWS::Lambda"))</code></p><p>Same service query with additional filtering:</p><p><code class="language-plaintext highlighter-rouge">service(id(name: "proto-publisher-sqs", type: "AWS::Lambda")) { responsetime &gt;= 0.172 AND responsetime &lt;= 0.366 AND ok = true }</code></p><p>Traces that interact with lambda functions:</p><p><code class="language-plaintext highlighter-rouge">service(id(type: "AWS::Lambda"))</code></p><p>Failed lambda functions with errors:</p><p><code class="language-plaintext highlighter-rouge">service(id(type: "AWS::Lambda")){fault}</code></p><p><code class="language-plaintext highlighter-rouge">service(id(type: "AWS::Lambda")){error}</code></p><h3 id="id-unique-object-in-aws-environment"><span class="me-2">ID unique object in AWS environment</span><a href="#id-unique-object-in-aws-environment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote class="prompt-tip"><p>In <code class="language-plaintext highlighter-rouge">Edge</code> and <code class="language-plaintext highlighter-rouge">Service</code> queries <code class="language-plaintext highlighter-rouge">id</code> function is used. It allows to narrow the scope to dedicated service based on defined preconditions with pattern: <code class="language-plaintext highlighter-rouge">id(name: "service-name", type:"service::type", account.id:"aws-account-id")</code></p></blockquote><p>After defining the <code class="language-plaintext highlighter-rouge">id</code> it can be passed to <code class="language-plaintext highlighter-rouge">service</code> or <code class="language-plaintext highlighter-rouge">edge</code> DSL:</p><p><code class="language-plaintext highlighter-rouge">service(id(type: "AWS::Lambda")</code> to get all lambda functions</p><p><code class="language-plaintext highlighter-rouge">service(id(account.id: "xxxxxxx"))</code> - traces that are interacting with entities from other AWS account (if centralized monitoring/tracing account is used).</p><h3 id="annotations-and-its-values-also-allow-querying-in-dsl"><span class="me-2">Annotations and its values also allow querying in DSL</span><a href="#annotations-and-its-values-also-allow-querying-in-dsl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">annotation.KEY</code></p><p>Query traces with Subsegments that have annotation MemoryLimitInMB</p><p><code class="language-plaintext highlighter-rouge">annotation.MemoryLimitInMB</code></p><p>Same query with values filtering (any memory except 128M)</p><p><code class="language-plaintext highlighter-rouge">annotation.MemoryLimitInMB != 128</code></p><p>Subsegments that contain ADMIN annotation</p><p><code class="language-plaintext highlighter-rouge">annotation.ADMIN</code></p><p>Subsegments that do not contain ADMIN annotation</p><p><code class="language-plaintext highlighter-rouge">!annotation.ADMIN</code></p><p>Lambda functions that have segments with user ‘BOB ‘</p><p><code class="language-plaintext highlighter-rouge">service(id(type: "AWS::Lambda")) AND user = 'BOB'</code></p><h3 id="http-specific-queries-including-status-codes-ip-latencies"><span class="me-2">HTTP specific queries including status codes, IP, latencies</span><a href="#http-specific-queries-including-status-codes-ip-latencies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">http.status != 200</code></p><p><code class="language-plaintext highlighter-rouge">responsetime &gt; 0.2</code></p><p><code class="language-plaintext highlighter-rouge">http.url CONTAINS "/api/proto/"</code></p><p><code class="language-plaintext highlighter-rouge">http.method = GET</code></p><p><code class="language-plaintext highlighter-rouge">http.useragent BEGINSWITH curl</code></p><p><code class="language-plaintext highlighter-rouge">http.clientip = 8.8.8.8</code></p><h3 id="group-queries"><span class="me-2">Group queries</span><a href="#group-queries" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">group.name = "low_latency_services"</code></p><h2 id="grouping-only-services-and-components-that-you-are-interested-in-not-entire-ecosystem"><span class="me-2">Grouping only services and components that you are interested in (not entire ecosystem)</span><a href="#grouping-only-services-and-components-that-you-are-interested-in-not-entire-ecosystem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Using groups on the Service map enables a more focused view of the elements present, displaying only the components that interact with traces following the defined group criteria. This feature is particularly valuable when dealing with complex ecosystems of components, such as those involving data processing, API request and response flows, and asynchronous workers based on queues. With multiple flows and components, the landscape can become overwhelming, making it challenging to observe only the elements currently relevant to your interests. The use of groups helps streamline this process by allowing for a more tailored and efficient analysis of the system.</p><p><a href="/images/posts/xray2/group_selector.png" class="popup img-link shimmer"><img src="/images/posts/xray2/group_selector.png" alt="img.png" loading="lazy"></a></p><p>For instance, in the following example, a troubleshooting group named <strong>low_latency_services</strong> has been created with a filter expression of <code class="language-plaintext highlighter-rouge">responsetime &gt; 0.5</code></p><p><a href="/images/posts/xray2/grouping.png" class="popup img-link shimmer"><img src="/images/posts/xray2/grouping.png" alt="img.png" loading="lazy"></a></p><h2 id="interaction-with-groups-from-aws-cli"><span class="me-2">Interaction with groups from aws cli</span><a href="#interaction-with-groups-from-aws-cli" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Also, we can perform CRUD operations with xray groups using aws cli:</p><ul><li>aws xray create-group<li>aws xray get-groups<li>aws xray update-group<li>aws xray delete-group</ul><div file="get all existing groups" class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="get all existing groups"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>aws xray get-groups
<span class="o">{</span>
    <span class="s2">"Groups"</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"GroupName"</span>: <span class="s2">"Default"</span>,
            <span class="s2">"GroupARN"</span>: <span class="s2">"arn:aws:xray:eu-central-1:xxxxxxxx:group/Default"</span>,
            <span class="s2">"InsightsConfiguration"</span>: <span class="o">{</span>
                <span class="s2">"InsightsEnabled"</span>: <span class="nb">true</span>,
                <span class="s2">"NotificationsEnabled"</span>: <span class="nb">false</span>
            <span class="o">}</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"GroupName"</span>: <span class="s2">"low-latency-services"</span>,
            <span class="s2">"GroupARN"</span>: <span class="s2">"arn:aws:xray:eu-central-1:xxxxxxxx:group/low-latency-services/UYCODCEBA"</span>,
            <span class="s2">"FilterExpression"</span>: <span class="s2">"responsetime &gt; 0.5"</span>,
            <span class="s2">"InsightsConfiguration"</span>: <span class="o">{</span>
                <span class="s2">"InsightsEnabled"</span>: <span class="nb">true</span>,
                <span class="s2">"NotificationsEnabled"</span>: <span class="nb">false</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">]</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><strong>xray</strong> is a robust tool that provides a broad range of capabilities, and we have only begun to scratch the surface in this and previous posts. In the next series, we will continue delving deeper.</p><h2 id="references-links"><span class="me-2">References (Links)</span><a href="#references-links" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-console-servicemap.html">https://docs.aws.amazon.com/xray/latest/devguide/xray-console-servicemap.html</a><li><a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-console-traces.html">https://docs.aws.amazon.com/xray/latest/devguide/xray-console-traces.html</a><li><a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-console-filters.html">https://docs.aws.amazon.com/xray/latest/devguide/xray-console-filters.html</a><li><a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-console-groups.html">https://docs.aws.amazon.com/xray/latest/devguide/xray-console-groups.html</a><li><a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-api-configuration.html">https://docs.aws.amazon.com/xray/latest/devguide/xray-api-configuration.html</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/aws/">aws</a>, <a href="/categories/xray/">xray</a>, <a href="/categories/monitoring/">monitoring</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/xray/" class="post-tag no-text-decoration" >xray</a> <a href="/tags/monitoring/" class="post-tag no-text-decoration" >monitoring</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=AWS%20XRAY%20tracing.%20Part%202:%20Advanced.%20Querying%20&%20Grouping.%20-%20Engineer's%20Notes&url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F03%2F21%2Fxra-tracing-2.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=AWS%20XRAY%20tracing.%20Part%202:%20Advanced.%20Querying%20&%20Grouping.%20-%20Engineer's%20Notes&u=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F03%2F21%2Fxra-tracing-2.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F03%2F21%2Fxra-tracing-2.html&text=AWS%20XRAY%20tracing.%20Part%202:%20Advanced.%20Querying%20&%20Grouping.%20-%20Engineer's%20Notes" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F03%2F21%2Fxra-tracing-2.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/2025/09/26/multiagnet-n8n-bedrock.html">Orchestrating AI multi-agent infrastructure with AWS Bedrock, OpenAI and n8n</a><li class="text-truncate lh-lg"> <a href="/posts/2025/07/20/elastic-cache-vector.html">Amazon ElastiCache Redis as a Vector Embeddings Storage for Semantic Search in AWS Community Blog posts</a><li class="text-truncate lh-lg"> <a href="/posts/2025/09/17/duckdb-s3.html">Running analytics queries from your machine with Zero-BigData stack needed on top of AWS S3(compressed JSON, Parquet, csv) or other DataSources</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/02/dynamo-design.html">DynamoDB Table Design Principles - NoSQL Modeling</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/04/dynamo-one-to-many.html">DynamoDB Table Design Principles - One-To-Many Relationships in NoSQL</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/2023/03/01/xra-tracing.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1677646800" data-df="ll" > Mar 1, 2023 </time><h4 class="pt-0 my-2">AWS XRAY tracing. Part 1: Foundational</h4><div class="text-muted"><p>Abstract Having used AWS xray for a while now, I can attest to its effectiveness as a tracing and monitoring service. It has saved me a significant amount of time, helped troubleshoot complex issu...</p></div></div></a></article><article class="col"> <a href="/posts/2023/03/27/xra-tracing-3.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1679925600" data-df="ll" > Mar 27, 2023 </time><h4 class="pt-0 my-2">AWS XRAY tracing. Part 3: Sampling & Billing</h4><div class="text-muted"><p>Abstract AWS x-ray Sampling allows defining traces recording behavior (rate of traces per-second, predicates to filter what traces to record, etc.) Applying different sampling configurations we ca...</p></div></div></a></article><article class="col"> <a href="/posts/2023/03/07/mingrammer.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1678165200" data-df="ll" > Mar 7, 2023 </time><h4 class="pt-0 my-2">Diagrams-as-a-Code DaC with Mingrammer for Public Cloud Providers and Agnostic Stacks.</h4><div class="text-muted"><p>Abstract During my analysis of open-source libraries that are suitable for rendering AWS components, in order to simplify the understanding and documenting of application architecture I discovered ...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/2023/03/07/mingrammer.html" class="btn btn-outline-primary" aria-label="Older" ><p>Diagrams-as-a-Code DaC with Mingrammer for Public Cloud Providers and Agnostic Stacks.</p></a> <a href="/posts/2023/03/26/jekyl-plugin.html" class="btn btn-outline-primary" aria-label="Newer" ><p>Developing plugin for Jekyll</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span> <span data-bs-toggle="tooltip" data-bs-placement="top" title="2025-09-26 20:11:52 +0300 &#013;be60bb44e6416aa69b8fd68791db025be40c523c">Build version: be60bb4</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'tsypuk/tsypuk.github.io', 'data-repo-id': 'R_kgDOIxaFiw', 'data-category': 'General', 'data-category-id': 'DIC_kwDOIxaFi84CUSfn', 'data-mapping': 'og:title', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'top', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
