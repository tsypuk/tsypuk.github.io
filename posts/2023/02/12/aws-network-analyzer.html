<!doctype html><html lang="en" ><head> <script async src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Troubleshooting Network Issues with AWS Network Access Analyzer and Reachability Analyzer | by Roman Tsypuk" /><meta name="author" content="Roman Tsypuk" /><meta property="og:locale" content="en" /><meta name="description" content="AWS has recently introduced two powerful network tools: the Network Access Analyzer and the Reachability Analyzer. Both of these tools utilize a similar algorithm, producing similarly comprehensive reports." /><meta property="og:description" content="AWS has recently introduced two powerful network tools: the Network Access Analyzer and the Reachability Analyzer. Both of these tools utilize a similar algorithm, producing similarly comprehensive reports." /><meta property="twitter:description" content="AWS has recently introduced two powerful network tools: the Network Access Analyzer and the Reachability Analyzer. Both of these tools utilize a similar algorithm, producing similarly comprehensive reports." /><link rel="canonical" href="https://tsypuk.github.io/posts/2023/02/12/aws-network-analyzer.html" /><meta property="og:url" content="https://tsypuk.github.io/posts/2023/02/12/aws-network-analyzer.html" /><meta property="og:site_name" content="Engineer’s Notes | Roman Tsypuk" /><meta property="og:image" content="https://tsypuk.github.io/images/banners/twitter/banner-network-analyzer.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-02-12T16:00:00+02:00" /><meta name="publish_date" property="og:publish_date" content="2023-02-12T16:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tsypuk.github.io/images/banners/twitter/banner-network-analyzer.png" /><meta property="twitter:title" content="Troubleshooting Network Issues with AWS Network Access Analyzer and Reachability Analyzer | by Roman Tsypuk" /><meta name="twitter:site" content="@roman_tsypuk" /><meta name="twitter:creator" content="@roman_tsypuk" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Roman Tsypuk"},"dateModified":"2024-02-25T18:38:06+02:00","datePublished":"2023-02-12T16:00:00+02:00","description":"AWS has recently introduced two powerful network tools: the Network Access Analyzer and the Reachability Analyzer. Both of these tools utilize a similar algorithm, producing similarly comprehensive reports.","headline":"Troubleshooting Network Issues with AWS Network Access Analyzer and Reachability Analyzer","image":{"twitter":"/images/banners/twitter/banner-network-analyzer.png","url":"https://tsypuk.github.io/images/banners/twitter/banner-network-analyzer.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tsypuk.github.io/posts/2023/02/12/aws-network-analyzer.html"},"url":"https://tsypuk.github.io/posts/2023/02/12/aws-network-analyzer.html"}</script><title>Troubleshooting Network Issues with AWS Network Access Analyzer and Reachability Analyzer | Engineer's Notes</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Engineer's Notes"><meta name="application-name" content="Engineer's Notes"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js,npm/mermaid@11.4.0/dist/mermaid.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script async src="/assets/js/data/mathjax.js"></script> <script async src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/images/avatar/rtsypuk.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Engineer's Notes</a><p class="site-subtitle fst-italic mb-0">Cloud, Infrastructure, Architecture, Networking</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories.html" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags.html" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archived_posts.html" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/roman_tsypuk.html" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tsypuk" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/roman_tsypuk" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/roman-tsypuk" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['tsypuk_conf','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Troubleshooting Network Issues with AWS Network Access Analyzer and Reachability Analyzer</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Troubleshooting Network Issues with AWS Network Access Analyzer and Reachability Analyzer</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1676210400" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 12, 2023 </time> </span> <span> Updated <time data-ts="1708879086" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 25, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/images/banners/1200/pexels-lina-mamone-1472612.jpeg" class="popup img-link preview-img shimmer"><img src="/images/banners/1200/pexels-lina-mamone-1472612.jpeg" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1226 words" > <em>6 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Troubleshooting Network Issues with AWS Network Access Analyzer and Reachability Analyzer</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Troubleshooting Network Issues with AWS Network Access Analyzer and Reachability Analyzer</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="abstract"><span class="me-2">Abstract</span><a href="#abstract" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>AWS has recently introduced two powerful network tools: the <strong>Network Access Analyzer</strong> and the <strong>Reachability Analyzer</strong>. Both of these tools utilize a similar algorithm, producing similarly comprehensive reports. However, the Network Access Analyzer is geared towards identifying unauthorized access. It assumes that there should be no access between the source and target that you have configured, and alerts you to any deviations from that expectation.</p><p>On the other hand, the Reachability Analyzer operates in the opposite manner. It detects the path between the source and target, providing detailed information about the intermediate components involved (such as ENIs, subnets, routing tables, NACLs, NATs, IGWs, etc.). If there is no connection, the tool will alert you to the issue.</p><p>According to the AWS documentation, these tools do not utilize actual network traffic or send any packets. Instead, they use a mathematical model to analyze the VPC configuration. This allows for efficient and accurate analysis, without any of the latency or security concerns associated with sending network packets.</p><h2 id="network-setup"><span class="me-2">Network setup</span><a href="#network-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this blog post, we will be exploring a standard VPC setup with a private subnet that has limited outbound internet access via a NAT Gateway. The instances in the private subnet are able to communicate within the VPC using the local route, but are not directly accessible from the internet. To facilitate system updates and package installations, a NAT instance is provisioned in the public subnet. The NAT instance is set as the default route in the private subnet.</p><p><a href="/images/posts/aws-network-analyzer/vpc.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/vpc.png" alt="vpc.png" loading="lazy"></a></p><p>We will be utilizing both the Network Analyzer and the Reachability Analyzer in this setup and will intentionally introduce several faults into various components of the traffic chain to demonstrate how check tools can detect and report them. This will provide a hands-on demonstration of the capabilities of these powerful AWS network tools.</p><h2 id="network-analyzer-setup"><span class="me-2">Network analyzer setup:</span><a href="#network-analyzer-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When setting up an analyzer in AWS, there are several options to choose from. We will be focusing on two of these options: access from the Internet Gateway and access to the Internet Gateway.</p><p>As source and destination we can detect communication between following entities:</p><ul><li>VPCs<li>Subnets<li>Network interfaces<li>Internet Gateways<li>VPN Gateways<li>VPC Endpoint Service<li>Peering Connections<li>Transit Gateway Attachments<li>Resource Groups<li>Security Groups</ul><p><a href="/images/posts/aws-network-analyzer/nwa_options.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/nwa_options.png" alt="nwa_options.png" loading="lazy"></a></p><p>Step1: choose the source:</p><p><a href="/images/posts/aws-network-analyzer/nwa_types.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/nwa_types.png" alt="nwa_types.png" loading="lazy"></a></p><p>Step2: choose the target:</p><p><a href="/images/posts/aws-network-analyzer/nwa_targets.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/nwa_targets.png" alt="nwa_targets.png" loading="lazy"></a></p><p>Once the configuration is complete it is also displayed in JSON format in aws console:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"MatchPaths"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"ResourceStatement"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Resources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"i-0xxxxxx"</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"Destination"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"ResourceStatement"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"ResourceTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"AWS::EC2::InternetGateway"</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>You can trigger analyzer not only from aws console but also using aws cli by specifying this JSON config:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>aws ec2 create-network-insights-access-scope <span class="nt">--cli-input-json</span> file://path-to-access-scope-file.json
</pre></table></code></div></div><h2 id="traffic-from-ec2-to-internet-gw"><span class="me-2">Traffic from EC2 to Internet GW</span><a href="#traffic-from-ec2-to-internet-gw" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Analysis is done for both TCP and UDP protocols, we can switch between finding. <a href="/images/posts/aws-network-analyzer/nwa_results_protocols.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/nwa_results_protocols.png" alt="nwa_results_protocols.png" loading="lazy"></a></p><p>We can observe comprehensive view of the communication pathways within your VPC. The results display the full network path and all the components between the source and destination, along with detailed information about each component. With this task Analyzer performs perfectly well.</p><p><a href="/images/posts/aws-network-analyzer/nwa_result_p1.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/nwa_result_p1.png" alt="nwa_result_p1.png" loading="lazy"></a></p><p>One of the key benefits of these tools is the ability to quickly identify any issues with the configuration of your VPC. If any component is configured in a way that does not allow traffic, it will be marked in red and a detailed message indicating the issue will be displayed.</p><p>This level of detail and visibility into the communication pathways in your VPC is invaluable for ensuring that your VPC is optimally configured for both security and accessibility. By quickly identifying and resolving any issues, you can ensure that your VPC is functioning as expected, and that your resources are protected and accessible.</p><p><a href="/images/posts/aws-network-analyzer/nwa_results_p2.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/nwa_results_p2.png" alt="nwa_results_p2.png" loading="lazy"></a></p><h2 id="traffic-from-internet-gw-to-ec2"><span class="me-2">Traffic from Internet GW to EC2</span><a href="#traffic-from-internet-gw-to-ec2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now we will test inbound traffic from Internet gateway to EC2 instance. Since it is located in private subnet there should be no connection. Following configuration is applied:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"MatchPaths"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"ResourceStatement"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"ResourceTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"AWS::EC2::InternetGateway"</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"Destination"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"ResourceStatement"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Resources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"i-0xxxxxxx"</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>As expected no finding detected (no inbound traffic): <a href="/images/posts/aws-network-analyzer/no_findings.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/no_findings.png" alt="no_findings.png" loading="lazy"></a></p><h2 id="reachability-analyzer"><span class="me-2">Reachability Analyzer</span><a href="#reachability-analyzer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now lets use another tool - Reachability Analyzer. Configuration is pretty similar. <a href="/images/posts/aws-network-analyzer/reachability.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/reachability.png" alt="reachability.png" loading="lazy"></a></p><h1 id="fault-injection">Fault injection</h1><p>The process of identifying the root cause of network configuration issues can be a time-consuming and challenging task, given the numerous players involved, such as instances, attached Elastic Network Interfaces (ENI), security groups, access control lists (ACL), routing tables, subnets, NAT gateways, and internet gateways. However, the use of a Reachability Analyzer can simplify this process and make it more efficient.</p><h2 id="fault1-security-group-break-delete-outbound"><span class="me-2">Fault1: Security Group break (delete outbound)</span><a href="#fault1-security-group-break-delete-outbound" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We have misconfigured Outbound Security Group on ENI of our running EC2 instance - and analysis report that Internet gateway is not reachable. <a href="/images/posts/aws-network-analyzer/nwr_not_reachable.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/nwr_not_reachable.png" alt="nwr_not_reachable.png" loading="lazy"></a></p><p>Report looks awesome, it identifies exact root cause - the eni security group and error message: <strong>ENI_SG_RULES_MISMATCH</strong>.</p><p><a href="/images/posts/aws-network-analyzer/nwr_sg.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/nwr_sg.png" alt="nwr_sg.png" loading="lazy"></a></p><h2 id="fault2-routing-table-delete-default-route-to-nat"><span class="me-2">Fault2: Routing table (delete default route to NAT)</span><a href="#fault2-routing-table-delete-default-route-to-nat" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now lets update routing table of private subnet where EC2 instance is deployed and delete default route to NAT gateway. As a result, our EC2 instance will be fully isolated from external communication and unable to receive software updates or make outbound connections. <a href="/images/posts/aws-network-analyzer/nwr_routetable.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/nwr_routetable.png" alt="nwr_routetable.png" loading="lazy"></a></p><p>Error message <strong>NO_ROUTE_TO_DESTINATION</strong> again perfectly target misconfigured component.</p><h2 id="fault3-detached-nat-gateway"><span class="me-2">Fault3: Detached NAT gateway</span><a href="#fault3-detached-nat-gateway" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/images/posts/aws-network-analyzer/nwr_routetable.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/nwr_routetable.png" alt="nwr_routetable.png" loading="lazy"></a> Since NAT gateway was deleted, now its route in private subnet is marked as <strong>BlackHole</strong>. Error message <strong>NO_ROUTE_TO_DESTINATION</strong> is not so informative, but we have good starting point for troubleshooting.</p><h2 id="fault4-nacl-in-public-sn-deny-all-outbound-traffic"><span class="me-2">Fault4: NACL in public SN Deny all outbound traffic</span><a href="#fault4-nacl-in-public-sn-deny-all-outbound-traffic" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We are now proceeding with the restoration of all configurations to initial working state and next will modify the public SN Access Control List to restrict any outgoing network traffic ensuring that no instances have outbound connection to internet. <a href="/images/posts/aws-network-analyzer/nwr_routetable.png" class="popup img-link shimmer"><img src="/images/posts/aws-network-analyzer/nwr_routetable.png" alt="nwr_routetable.png" loading="lazy"></a></p><p>Unfortunately, the results of the analysis were not as anticipated. The Reachability Analyzer identified an issue with the routing table in the private subnet, but there was no indication of any problems with the public subnet.</p><p>This discrepancy is not necessarily a bug, as the Reachability Analyzer evaluates connectivity by tracing the path from source to destination. If there is no configuration in the private subnet to reach destinations with internet access, the routing table is considered misconfigured.</p><p>Therefore, it appears that the Reachability Analyzer is correctly marking the public subnet as having no internet access.</p><p>However, this result should not be taken as the exact root cause, but rather as a starting point for manual troubleshooting.</p><p>After making necessary changes, we are ready to run the analysis again to verify the results and identify the <strong>next wave of potential issues</strong>.</p><h2 id="conclusions"><span class="me-2">Conclusions</span><a href="#conclusions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Both tools are highly effective in troubleshooting network availability and detecting unauthorized access.</p><p>Although there was a small error in report of the last experiment, a skilled human technician would likely have arrived at the same conclusion.</p><p>Another key benefit is the ability to integrate these tools into various pipelines and scans, enabling their regular use and contributing to the development of a more robust infrastructure.</p><p>Looking ahead, it is possible that future advancements in network availability search algorithms will be able to resolve this case with public subnet misconfiguration with even greater accuracy.</p><h2 id="links"><span class="me-2">Links</span><a href="#links" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://docs.aws.amazon.com/vpc/latest/network-access-analyzer/getting-started-cli.html0">network access analyzer</a><li><a href="https://docs.aws.amazon.com/vpc/latest/reachability/what-is-reachability-analyzer.html">network reachability analyzer</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/aws/">aws</a>, <a href="/categories/analyzer/">analyzer</a>, <a href="/categories/network/">network</a>, <a href="/categories/traceroute/">traceroute</a>, <a href="/categories/vpc/">vpc</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/analyzer/" class="post-tag no-text-decoration" >analyzer</a> <a href="/tags/network/" class="post-tag no-text-decoration" >network</a> <a href="/tags/traceroute/" class="post-tag no-text-decoration" >traceroute</a> <a href="/tags/vpc/" class="post-tag no-text-decoration" >vpc</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Troubleshooting%20Network%20Issues%20with%20AWS%20Network%20Access%20Analyzer%20and%20Reachability%20Analyzer%20-%20Engineer's%20Notes&url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F02%2F12%2Faws-network-analyzer.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Troubleshooting%20Network%20Issues%20with%20AWS%20Network%20Access%20Analyzer%20and%20Reachability%20Analyzer%20-%20Engineer's%20Notes&u=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F02%2F12%2Faws-network-analyzer.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F02%2F12%2Faws-network-analyzer.html&text=Troubleshooting%20Network%20Issues%20with%20AWS%20Network%20Access%20Analyzer%20and%20Reachability%20Analyzer%20-%20Engineer's%20Notes" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F02%2F12%2Faws-network-analyzer.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/2025/09/26/multiagnet-n8n-bedrock.html">Orchestrating AI multi-agent infrastructure with AWS Bedrock, OpenAI and n8n</a><li class="text-truncate lh-lg"> <a href="/posts/2025/07/20/elastic-cache-vector.html">Amazon ElastiCache Redis as a Vector Embeddings Storage for Semantic Search in AWS Community Blog posts</a><li class="text-truncate lh-lg"> <a href="/posts/2025/09/17/duckdb-s3.html">Running analytics queries from your machine with Zero-BigData stack needed on top of AWS S3(compressed JSON, Parquet, csv) or other DataSources</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/02/dynamo-design.html">DynamoDB Table Design Principles - NoSQL Modeling</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/04/dynamo-one-to-many.html">DynamoDB Table Design Principles - One-To-Many Relationships in NoSQL</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/2023/02/08/aws-vpc-traffic-mirroring-ids-suricata.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1675850400" data-df="ll" > Feb 8, 2023 </time><h4 class="pt-0 my-2">AWS VPC traffic mirroring to IDS. Deep dive with Wireshark.</h4><div class="text-muted"><p>Abstract Traffic mirroring refers to the process of copying network traffic from one network port or interface to another for analysis, monitoring, or security purposes. There are multiple options...</p></div></div></a></article><article class="col"> <a href="/posts/2023/09/11/aws-clientnpv-automated.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1694440800" data-df="ll" > Sep 11, 2023 </time><h4 class="pt-0 my-2">Automating AWS Client VPN creation with Terraform and Scripts</h4><div class="text-muted"><p>Abstract In previous Post Latest AWS Managed Client VPN Connection, we checked how managed AWS VPN Client allows much faster and secure bootstrap OpenVPN server compared to DIY EC2-based instance s...</p></div></div></a></article><article class="col"> <a href="/posts/2023/09/09/aws-clientvpn.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1694268000" data-df="ll" > Sep 9, 2023 </time><h4 class="pt-0 my-2">Latest AWS Managed Client VPN Connection</h4><div class="text-muted"><p>Abstract Creating and managing VPN connections to AWS Cloud Networks is a regular task that we periodically face with. One of the communication channels is VPN connection. For a while if you want t...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/2023/02/08/aws-vpc-traffic-mirroring-ids-suricata.html" class="btn btn-outline-primary" aria-label="Older" ><p>AWS VPC traffic mirroring to IDS. Deep dive with Wireshark.</p></a> <a href="/posts/2023/02/19/awsshell.html" class="btn btn-outline-primary" aria-label="Newer" ><p>This is not just another AWS Shell. It's The Force that will be with you, always.</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span> <span data-bs-toggle="tooltip" data-bs-placement="top" title="2025-09-26 20:11:52 +0300 &#013;be60bb44e6416aa69b8fd68791db025be40c523c">Build version: be60bb4</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'tsypuk/tsypuk.github.io', 'data-repo-id': 'R_kgDOIxaFiw', 'data-category': 'General', 'data-category-id': 'DIC_kwDOIxaFi84CUSfn', 'data-mapping': 'og:title', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'top', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
