<!doctype html><html lang="en" ><head> <script async src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="DynamoDB Table Design Principles - Filtering | by Roman Tsypuk" /><meta name="author" content="Roman Tsypuk" /><meta property="og:locale" content="en" /><meta name="description" content="We will continue exploring different technics that allow to extend Access Patterns to a Single Table." /><meta property="og:description" content="We will continue exploring different technics that allow to extend Access Patterns to a Single Table." /><meta property="twitter:description" content="We will continue exploring different technics that allow to extend Access Patterns to a Single Table." /><link rel="canonical" href="https://tsypuk.github.io/posts/2023/10/06/dynamo-filters.html" /><meta property="og:url" content="https://tsypuk.github.io/posts/2023/10/06/dynamo-filters.html" /><meta property="og:site_name" content="Engineer’s Notes | Roman Tsypuk" /><meta property="og:image" content="https://tsypuk.github.io/images/banners/1200/pexels-pixabay-46235.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-10-06T17:00:00+03:00" /><meta name="publish_date" property="og:publish_date" content="2023-10-06T17:00:00+03:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tsypuk.github.io/images/banners/1200/pexels-pixabay-46235.jpeg" /><meta property="twitter:title" content="DynamoDB Table Design Principles - Filtering | by Roman Tsypuk" /><meta name="twitter:site" content="@roman_tsypuk" /><meta name="twitter:creator" content="@roman_tsypuk" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Roman Tsypuk"},"dateModified":"2025-07-20T17:36:47+03:00","datePublished":"2023-10-06T17:00:00+03:00","description":"We will continue exploring different technics that allow to extend Access Patterns to a Single Table.","headline":"DynamoDB Table Design Principles - Filtering","image":"https://tsypuk.github.io/images/banners/1200/pexels-pixabay-46235.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://tsypuk.github.io/posts/2023/10/06/dynamo-filters.html"},"url":"https://tsypuk.github.io/posts/2023/10/06/dynamo-filters.html"}</script><title>DynamoDB Table Design Principles - Filtering | Engineer's Notes</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Engineer's Notes"><meta name="application-name" content="Engineer's Notes"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js,npm/mermaid@11.4.0/dist/mermaid.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/images/avatar/rtsypuk.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Engineer's Notes</a><p class="site-subtitle fst-italic mb-0">Cloud, Infrastructure, Architecture, Networking</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories.html" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags.html" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archived_posts.html" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/roman_tsypuk.html" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tsypuk" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/roman_tsypuk" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/roman-tsypuk" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['tsypuk_conf','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>DynamoDB Table Design Principles - Filtering</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>DynamoDB Table Design Principles - Filtering</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1696600800" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 6, 2023 </time> </span> <span> Updated <time data-ts="1753022207" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 20, 2025 </time> </span><div class="mt-3 mb-3"> <a href="/images/banners/1200/pexels-pixabay-46235.jpeg" class="popup img-link preview-img shimmer"><img src="/images/banners/1200/pexels-pixabay-46235.jpeg" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="926 words" > <em>5 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">DynamoDB Table Design Principles - Filtering</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">DynamoDB Table Design Principles - Filtering</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="abstract"><span class="me-2">Abstract</span><a href="#abstract" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We will continue exploring different technics that allow to extend Access Patterns to a Single Table.</p><h2 id="target-dynamodb-table-structure"><span class="me-2">Target DynamoDB Table Structure</span><a href="#target-dynamodb-table-structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/images/posts/dynamo/diagram3.png" class="popup img-link w-100 center shimmer"><img src="/images/posts/dynamo/diagram3.png" alt="diagram2.png" width="100%" loading="lazy"></a></p><p>NoSQL DynamoDB Table Structure is generated using <a href="https://blog.tsypuk.github.io/multicloud-diagrams/">MultiCloud Diagrams Framework</a></p><h2 id="access-patterns-to-implement"><span class="me-2">Access Patterns to implement</span><a href="#access-patterns-to-implement" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In the previous post <a href="/posts/2023/10/04/dynamo-one-to-many.html">DynamoDB Table Design Principles - One-To-Many Relationships in NoSQL</a> , when we implemented One-To-Many relationship using <strong>SingleTable</strong> Design Pattern, and we had completed first 3 Data access patterns:</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">ID<th style="text-align: left">Access Pattern<th style="text-align: left">Access BY<th style="text-align: left">Key Condition<tbody><tr><td style="text-align: left">A1<td style="text-align: left">Get user profile<td style="text-align: left">username<td style="text-align: left">PK = USER#alex AND BEGINS_WITH(SK, ‘PROFILE’)”<tr><td style="text-align: left">A2<td style="text-align: left">Get orders for user<td style="text-align: left">BY username<td style="text-align: left">PK = USER#alex AND BEGINS_WITH(SK, ‘ORDER#’)”<tr><td style="text-align: left">A3<td style="text-align: left">Get single order and order items<td style="text-align: left">GSI: orderid<td style="text-align: left">SK = ORDER#orderid</table></div><p>Now we will continue Table design to follow all other requested Access Patterns:</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">ID<th style="text-align: left">Access Pattern<tbody><tr><td style="text-align: left">A4<td style="text-align: left">Get orders for user by status<tr><td style="text-align: left">A5<td style="text-align: left">Get open orders<tr><td style="text-align: left">A5<td style="text-align: left">Get orders for user, shipped before 01.01.2023<tr><td style="text-align: left">A6<td style="text-align: left">Get orders for user, shipped Between 01.01.2023 - 01.02.2023</table></div><h3 id="rdbms-way-for-filtering"><span class="me-2">RDBMS-way for filtering</span><a href="#rdbms-way-for-filtering" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>All this Access Pattern are analogue to WHERE operation in RDBMS, if to write in native-SQL this will look like:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">ORDERS</span> <span class="k">WHERE</span> <span class="n">USERNAME</span> <span class="o">=</span> <span class="s1">'bob'</span> <span class="k">AND</span> <span class="n">ORDERDATE</span> <span class="o">&gt;</span> <span class="n">GETDATE</span><span class="p">()</span> <span class="o">-</span> <span class="mi">14</span>
</pre></table></code></div></div><h2 id="technic-4-filter-expression"><span class="me-2">Technic #4: Filter Expression</span><a href="#technic-4-filter-expression" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Both <strong>Query</strong> and <strong>Scan</strong> operations, support FilterExpressions:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">dynamodb</span><span class="sh">'</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span>
  <span class="n">TableName</span><span class="o">=</span><span class="sh">'</span><span class="s">UsersAndOrdersTable</span><span class="sh">'</span><span class="p">,</span>
  <span class="n">FilterExpression</span><span class="o">=</span><span class="sh">"</span><span class="s">Status = SHIPPED</span><span class="sh">"</span>
<span class="p">)</span>
</pre></table></code></div></div><p>Problems:</p><ul><li>to use the query we need always provide the <strong>PK</strong>, we can not query entire dataset.<li>more than that, because the Orders with same status are in different partitions we can not query them.</ul><h3 id="scan-filterexpression"><span class="me-2">Scan FilterExpression</span><a href="#scan-filterexpression" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">dynamodb</span><span class="sh">'</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="nf">scan</span><span class="p">(</span>
  <span class="n">TableName</span><span class="o">=</span><span class="sh">'</span><span class="s">UsersAndOrdersTable</span><span class="sh">'</span><span class="p">,</span>
  <span class="n">FilterExpression</span><span class="o">=</span><span class="sh">"</span><span class="s">Status = SHIPPED</span><span class="sh">"</span>
<span class="p">)</span>
</pre></table></code></div></div><h3 id="scan-with-filterexpression-evaluation-logic-under-the-hood"><span class="me-2">Scan with FilterExpression evaluation logic under the hood</span><a href="#scan-with-filterexpression-evaluation-logic-under-the-hood" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Following diagram describes how <code class="language-plaintext highlighter-rouge">FilterExpression</code> is evaluated in DynamoDB:</p><pre><code class="language-mermaid">stateDiagram
  [*] --&gt; s1
  state "Read all items" as s1
  note left of s1
    LIMIT in size of 1Mb
    notes.
  end note
  state "Filter Items that do not match" as s2
  state "Return results DataSet" as s3
  note left of s3
    Pros: less network transfer
    Cons: All items are read
  end note
  s1 --&gt; s2
  s2 --&gt; s3
  s3 --&gt; [*]
</code></pre><h3 id="detailed-problems-with-filterexpression-in-query-and-scan"><span class="me-2">Detailed Problems with <code class="language-plaintext highlighter-rouge">FilterExpression</code> in Query and Scan</span><a href="#detailed-problems-with-filterexpression-in-query-and-scan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If there is a 1GB of data in the Table, and <strong>predicate</strong> that is included to <strong>FilterExpression</strong> narrows the DataSet to only <strong>1KB</strong> of Data, since there is a HARD limit of 1Mb per single read operation - a scan will perform 1000 requests/responses network rounds to a table to read all 1GB of data and filter it to only 1KB.</p><p>This is the worst case scenario when you can experience long response time or even timeouts.</p><blockquote class="prompt-danger"><p>Filtered Scan will save bandwidth on a wire, will allow less aggregation on application side. But it will not save the performance and will not add effective data access.</p></blockquote><h2 id="technic-5-composite-sort-key"><span class="me-2">Technic #5: Composite Sort Key</span><a href="#technic-5-composite-sort-key" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In our Table we have Order <code class="language-plaintext highlighter-rouge">Status</code> and Order <code class="language-plaintext highlighter-rouge">CreatedAt</code> as a separated <strong>Attributes</strong> in the table:</p><p><a href="/images/posts/dynamo/init_table.png" class="popup img-link shimmer"><img src="/images/posts/dynamo/init_table.png" alt="initial_table.png" loading="lazy"></a></p><p>Instread, we will add new <strong>attribute</strong> <code class="language-plaintext highlighter-rouge">OrderStatusDate</code> that combines values of these both 2 Attributes (Status &amp; CreatedAt) - A <strong>Composite Sort Key</strong>.</p><p><a href="/images/posts/dynamo/composit_SK.png" class="popup img-link shimmer"><img src="/images/posts/dynamo/composit_SK.png" alt="table_with_composite sort_key.png" loading="lazy"></a></p><p>To provide <strong>A4</strong> access pattern, we will introduce a new <strong>GSI</strong> with <code class="language-plaintext highlighter-rouge">PartitionKey</code> of <strong>PK</strong> and <code class="language-plaintext highlighter-rouge">SortKey</code> with <strong>OrderStatusDate</strong>:</p><p><a href="/images/posts/dynamo/order_st_date_gsi.png" class="popup img-link shimmer"><img src="/images/posts/dynamo/order_st_date_gsi.png" alt="img.png" loading="lazy"></a></p><p>This is how <strong>A4</strong> query will look like:</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">ID<th style="text-align: left">Access Pattern<th style="text-align: left">Access BY<th style="text-align: left">Key Condition<tbody><tr><td style="text-align: left">A4<td style="text-align: left">Get orders for user by status<td style="text-align: left">GSI:<td style="text-align: left">PK = USER#alex AND BEGINS_WITH(OrderStatusDate, ‘SHIPPED#’)</table></div><p>More than that, <strong>Composite Sort Key</strong> allows to use both composite attributes when querying, reusing same GSI for more access patterns:</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">ID<th style="text-align: left">Access Pattern<th style="text-align: left">Access BY<th style="text-align: left">Key Condition<tbody><tr><td style="text-align: left">A5<td style="text-align: left">Get orders for user, shipped before 01.01.2023<td style="text-align: left">GSI:<td style="text-align: left">PK = USER#alex AND BEFORE(OrderStatusDate, ‘SHIPPED#01.01.2023’)<tr><td style="text-align: left">A6<td style="text-align: left">Get orders for user, shipped Between 01.01.2023 - 01.02.2023<td style="text-align: left">GSI:<td style="text-align: left">PK = USER#alex AND BETWEEN(OrderStatusDate, ‘SHIPPED#01.01.2023’, ‘SHIPPED#01.02.2023’)</table></div><h2 id="technic-6-sparse-index"><span class="me-2">Technic #6: Sparse Index</span><a href="#technic-6-sparse-index" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This is more a DataWareHouse DB access pattern - query all Database and get all Orders that are with ‘PLACED’ status only.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">ORDERS</span> <span class="k">WHERE</span> <span class="n">STATUS</span> <span class="o">=</span> <span class="s1">'PLACED'</span>
</pre></table></code></div></div><p>Orders are partitions based on <strong>PK</strong> <code class="language-plaintext highlighter-rouge">USER</code> - so there are multiple Orders with <code class="language-plaintext highlighter-rouge">PLACED</code> status, but they are stored within different <strong>partitions</strong>. We need to provide a global Filter for entire Table not a single partition.</p><p>Let’s add one more attribute <code class="language-plaintext highlighter-rouge">PlacedId</code> - it will be a <strong>marker attribute</strong> for Items that are in <code class="language-plaintext highlighter-rouge">PLACED</code> status. The value can be UUID, Date, PK, etc.</p><p><a href="/images/posts/dynamo/sparce_index.png" class="popup img-link shimmer"><img src="/images/posts/dynamo/sparce_index.png" alt="sparce_index.png" loading="lazy"></a></p><p>Next we will introduce new GSI index view, to effectively query Order with <strong>PLACED</strong> status:</p><p><a href="/images/posts/dynamo/placed_id_gsi.png" class="popup img-link shimmer"><img src="/images/posts/dynamo/placed_id_gsi.png" alt="img.png" loading="lazy"></a></p><p>There are 4 advantages when applying <code class="language-plaintext highlighter-rouge">sparce_index</code>:</p><ul><li>GSI index in size is <strong>limited</strong> to the number of <strong>Items</strong> that have <strong>SparceIndex</strong> key criteria<li>Entities set in index is limited to ORDER - there is no need to store relations for other types (more efficient storage)<li>once the item has changed its status its SparceIndex attribute should be dropped - after that it will not be returned in queries<li>Projection can be used to limit number of fields (attributes) that are needed when requesting (more effective storage)</ul><h2 id="conclusions"><span class="me-2">Conclusions</span><a href="#conclusions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Key takeaways whe applying Filtering to DynamoDB:</p><ul><li>Avoid using FilterExpression in general (with assumption that it can be applied only on small DataSets).<li>Use Composite Sort Key - that will allow to run optimal queries for both Attributes of the Key.<li>If Composite Sort Key is sharing the same Partition Key as Table, include it as LSI on table planning time, otherwise introduce GSI.</ul><h2 id="references-links"><span class="me-2">References (Links)</span><a href="#references-links" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="/posts/2023/10/02/dynamo-design.html">DynamoDB Table Design Principles - NoSQL Modeling</a><li><a href="/posts/2023/10/04/dynamo-one-to-many.html">DynamoDB Table Design Principles - One-To-Many Relationships in NoSQL</a><li><a href="https://github.com/tsypuk/samples/tree/main/dynamodb-filter">GitHub Sample CloudFormation and NoSQL Workbench exports for Filtering</a><li><a href="https://www.youtube.com/watch?v=DIQVJqiSUkE">Alex Debrie Talk on re:Invent 2019 Data modeling with Amazon DynamoDB (CMY304)</a><li><a href="https://blog.tsypuk.github.io/multicloud-diagrams/">Multicloud Diagrams</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/aws/">aws</a>, <a href="/categories/dynamodb/">dynamodb</a>, <a href="/categories/nosql/">nosql</a>, <a href="/categories/filtering/">filtering</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/dynamodb/" class="post-tag no-text-decoration" >dynamodb</a> <a href="/tags/nosql/" class="post-tag no-text-decoration" >nosql</a> <a href="/tags/filtering/" class="post-tag no-text-decoration" >filtering</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=DynamoDB%20Table%20Design%20Principles%20-%20Filtering%20-%20Engineer's%20Notes&url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F10%2F06%2Fdynamo-filters.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=DynamoDB%20Table%20Design%20Principles%20-%20Filtering%20-%20Engineer's%20Notes&u=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F10%2F06%2Fdynamo-filters.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F10%2F06%2Fdynamo-filters.html&text=DynamoDB%20Table%20Design%20Principles%20-%20Filtering%20-%20Engineer's%20Notes" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F10%2F06%2Fdynamo-filters.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/2025/09/26/multiagnet-n8n-bedrock.html">Orchestrating AI multi-agent infrastructure with AWS Bedrock, OpenAI and n8n</a><li class="text-truncate lh-lg"> <a href="/posts/2025/07/20/elastic-cache-vector.html">Amazon ElastiCache Redis as a Vector Embeddings Storage for Semantic Search in AWS Community Blog posts</a><li class="text-truncate lh-lg"> <a href="/posts/2025/09/17/duckdb-s3.html">Running analytics queries from your machine with Zero-BigData stack needed on top of AWS S3(compressed JSON, Parquet, csv) or other DataSources</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/02/dynamo-design.html">DynamoDB Table Design Principles - NoSQL Modeling</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/04/dynamo-one-to-many.html">DynamoDB Table Design Principles - One-To-Many Relationships in NoSQL</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/2023/10/04/dynamo-one-to-many.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1696428000" data-df="ll" > Oct 4, 2023 </time><h4 class="pt-0 my-2">DynamoDB Table Design Principles - One-To-Many Relationships in NoSQL</h4><div class="text-muted"><p>Abstract In Relational Database we used to have single Entity per Table, build relationships between them and assign constrains like Foreign Keys. In NoSQL DynamoDB world this became an Antipatter...</p></div></div></a></article><article class="col"> <a href="/posts/2023/10/02/dynamo-design.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1696255200" data-df="ll" > Oct 2, 2023 </time><h4 class="pt-0 my-2">DynamoDB Table Design Principles - NoSQL Modeling</h4><div class="text-muted"><p>Abstract DynamoDB is one of the most popular NoSQL DB storages, that has amazing performance and scaling characteristics and is widely used in many designs. There is mindshift that requires us to ...</p></div></div></a></article><article class="col"> <a href="/posts/2024/09/21/aws-nuke.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1726869600" data-df="ll" > Sep 21, 2024 </time><h4 class="pt-0 my-2">AWS-nuke controlled resources cleanup in multiple aws accounts</h4><div class="text-muted"><p>AWS-Nuke is an open-source tool, designed to automate the removal of AWS resources from an account. It can be used to quickly and safely delete all resources in a given AWS account, or it can be cu...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/2023/10/04/dynamo-one-to-many.html" class="btn btn-outline-primary" aria-label="Older" ><p>DynamoDB Table Design Principles - One-To-Many Relationships in NoSQL</p></a> <a href="/posts/2023/10/17/kineses-agent.html" class="btn btn-outline-primary" aria-label="Newer" ><p>AWS Kinesis Agent configuration and setup for Data Streaming to the Cloud</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span> <span data-bs-toggle="tooltip" data-bs-placement="top" title="2025-09-26 20:11:52 +0300 &#013;be60bb44e6416aa69b8fd68791db025be40c523c">Build version: be60bb4</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'tsypuk/tsypuk.github.io', 'data-repo-id': 'R_kgDOIxaFiw', 'data-category': 'General', 'data-category-id': 'DIC_kwDOIxaFi84CUSfn', 'data-mapping': 'og:title', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'top', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
