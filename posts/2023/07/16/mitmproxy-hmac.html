<!doctype html><html lang="en" ><head> <script async src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Intercepting AWS CLI and SDK API calls with MITM proxy. How ACCESS_KEY and ACCESS_SECRET_KEY are applied. Signature Version 4 Under the Hood. | by Roman Tsypuk" /><meta name="author" content="Roman Tsypuk" /><meta property="og:locale" content="en" /><meta name="description" content="In the previous post we have checked how to setup AWS API Gateway with AWS IAM authorization. To access its secured endpoint we were using Postman, all we need to call the API is to choose sigv4 algorithm, provide ACCESS_KEY, SECRET_ACCESS_KEY, region and service. Postman under the neath generates all the payload and sends the request." /><meta property="og:description" content="In the previous post we have checked how to setup AWS API Gateway with AWS IAM authorization. To access its secured endpoint we were using Postman, all we need to call the API is to choose sigv4 algorithm, provide ACCESS_KEY, SECRET_ACCESS_KEY, region and service. Postman under the neath generates all the payload and sends the request." /><meta property="twitter:description" content="In the previous post we have checked how to setup AWS API Gateway with AWS IAM authorization. To access its secured endpoint we were using Postman, all we need to call the API is to choose sigv4 algorithm, provide ACCESS_KEY, SECRET_ACCESS_KEY, region and service. Postman under the neath generates all the payload and sends the request." /><link rel="canonical" href="https://tsypuk.github.io/posts/2023/07/16/mitmproxy-hmac.html" /><meta property="og:url" content="https://tsypuk.github.io/posts/2023/07/16/mitmproxy-hmac.html" /><meta property="og:site_name" content="Engineer’s Notes | Roman Tsypuk" /><meta property="og:image" content="https://tsypuk.github.io/images/banners/1200/blo.jpeg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-07-16T17:00:00+03:00" /><meta name="publish_date" property="og:publish_date" content="2023-07-16T17:00:00+03:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tsypuk.github.io/images/banners/1200/blo.jpeg" /><meta property="twitter:title" content="Intercepting AWS CLI and SDK API calls with MITM proxy. How ACCESS_KEY and ACCESS_SECRET_KEY are applied. Signature Version 4 Under the Hood. | by Roman Tsypuk" /><meta name="twitter:site" content="@roman_tsypuk" /><meta name="twitter:creator" content="@roman_tsypuk" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Roman Tsypuk"},"dateModified":"2024-02-25T18:38:06+02:00","datePublished":"2023-07-16T17:00:00+03:00","description":"In the previous post we have checked how to setup AWS API Gateway with AWS IAM authorization. To access its secured endpoint we were using Postman, all we need to call the API is to choose sigv4 algorithm, provide ACCESS_KEY, SECRET_ACCESS_KEY, region and service. Postman under the neath generates all the payload and sends the request.","headline":"Intercepting AWS CLI and SDK API calls with MITM proxy. How ACCESS_KEY and ACCESS_SECRET_KEY are applied. Signature Version 4 Under the Hood.","image":"https://tsypuk.github.io/images/banners/1200/blo.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"https://tsypuk.github.io/posts/2023/07/16/mitmproxy-hmac.html"},"url":"https://tsypuk.github.io/posts/2023/07/16/mitmproxy-hmac.html"}</script><title>Intercepting AWS CLI and SDK API calls with MITM proxy. How ACCESS_KEY and ACCESS_SECRET_KEY are applied. Signature Version 4 Under the Hood. | Engineer's Notes</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Engineer's Notes"><meta name="application-name" content="Engineer's Notes"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js,npm/mermaid@11.4.0/dist/mermaid.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-LXECFRDHS1"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-LXECFRDHS1'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/images/avatar/rtsypuk.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Engineer's Notes</a><p class="site-subtitle fst-italic mb-0">Cloud, Infrastructure, Architecture, Networking</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories.html" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags.html" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archived_posts.html" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/roman_tsypuk.html" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tsypuk" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/roman_tsypuk" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/roman-tsypuk" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['tsypuk_conf','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Intercepting AWS CLI and SDK API calls with MITM proxy. How ACCESS_KEY and ACCESS_SECRET_KEY are applied. Signature Version 4 Under the Hood.</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Intercepting AWS CLI and SDK API calls with MITM proxy. How ACCESS_KEY and ACCESS_SECRET_KEY are applied. Signature Version 4 Under the Hood.</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1689516000" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 16, 2023 </time> </span> <span> Updated <time data-ts="1708879086" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 25, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/images/banners/1200/blo.jpeg" class="popup img-link preview-img shimmer"><img src="/images/banners/1200/blo.jpeg" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="968 words" > <em>5 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Intercepting AWS CLI and SDK API calls with MITM proxy. How ACCESS_KEY and ACCESS_SECRET_KEY are applied. Signature Version 4 Under the Hood.</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Intercepting AWS CLI and SDK API calls with MITM proxy. How ACCESS_KEY and ACCESS_SECRET_KEY are applied. Signature Version 4 Under the Hood.</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="abstract"><span class="me-2">Abstract</span><a href="#abstract" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In the previous post we have checked how to setup <a href="/posts/2023/06/24/api-gw-iam.html">AWS API Gateway with AWS IAM authorization</a>. To access its secured endpoint we were using Postman, all we need to call the API is to choose <code class="language-plaintext highlighter-rouge">sigv4</code> algorithm, provide <code class="language-plaintext highlighter-rouge">ACCESS_KEY</code>, <code class="language-plaintext highlighter-rouge">SECRET_ACCESS_KEY</code>, <code class="language-plaintext highlighter-rouge">region</code> and <code class="language-plaintext highlighter-rouge">service</code>. Postman under the neath generates all the payload and sends the request.</p><p>In this post we will deep dive into <code class="language-plaintext highlighter-rouge">AWS Sigv4</code>, see how it is applied, what happens with real ACCESS/SECRET KEYs. We will intercept and inspect the real payload of <code class="language-plaintext highlighter-rouge">aws cli</code> and check what is transferred over the network.</p><p>This topic pertains not only to the IAM-based endpoint of API Gateway, but also to any invocation using the <code class="language-plaintext highlighter-rouge">aws cli</code> or <code class="language-plaintext highlighter-rouge">aws sdk</code> library. Because the AWS infrastructure follows a layered architecture, where each service exposes publicly accessible API endpoints. As a result, the security mechanisms for these endpoints remain consistent across AWS services.</p><blockquote class="prompt-tip"><p>Signature Version 4 is the AWS signing protocol. AWS also supports an extension, Signature Version 4A, which supports signatures for multi-Region API requests.</p></blockquote><h2 id="lab-setup-for-aws-calls-inspection"><span class="me-2">LAB setup for AWS calls inspection</span><a href="#lab-setup-for-aws-calls-inspection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/images/posts/mitm-proxy/setup.png" class="popup img-link shimmer"><img src="/images/posts/mitm-proxy/setup.png" alt="setup.png" loading="lazy"></a></p><h2 id="lets-create-fake-accesssecret-key"><span class="me-2">Let’s create fake ACCESS/SECRET KEY</span><a href="#lets-create-fake-accesssecret-key" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To do this, we are updating <code class="language-plaintext highlighter-rouge">~/.aws/config</code> with registering one more profile:</p><div class="language-properties highlighter-rouge"><div class="code-header"> <span data-label-text="Properties"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="err">[demo]</span>
<span class="py">region</span><span class="p">=</span><span class="s">eu-west-1</span>
<span class="py">output</span><span class="p">=</span><span class="s">json</span>
</pre></table></code></div></div><p>Also, we need to update <code class="language-plaintext highlighter-rouge">~/.aws/credentials</code></p><div class="language-properties highlighter-rouge"><div class="code-header"> <span data-label-text="Properties"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="err">[demo]</span>
<span class="py">AWS_ACCESS_KEY_ID</span><span class="p">=</span><span class="s">AKIA1111111111111111</span>
<span class="py">AWS_SECRET_ACCESS_KEY</span><span class="p">=</span><span class="s">CCCCCCCCCCCCCCCCCdus/1111111111111111111</span>
<span class="py">regions</span><span class="p">=</span><span class="s">eu-west-1</span>
</pre></table></code></div></div><p>Now let’s switch to newly created profile:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">AWS_PROFILE</span><span class="o">=</span>demo
</pre></table></code></div></div><h2 id="intercept-requests-with-mitmproxy"><span class="me-2">Intercept requests with mitmproxy</span><a href="#intercept-requests-with-mitmproxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s list S3 buckets, but for the endpoint we will forward <code class="language-plaintext highlighter-rouge">aws cli</code> requests to <code class="language-plaintext highlighter-rouge">mitmproxy</code>:</p><blockquote class="prompt-tip"><p>–endpoint-url <string> Specifies the URL to send the request to. For most commands, the AWS CLI automatically determines the URL based on the selected service and the specified AWS Region. However, some commands require that you specify an account-specific URL. You can also configure some AWS services to host an endpoint directly within your private VPC, which might then need to be specified. For a list of the standard service endpoints available in each Region, see AWS Regions and Endpoints in the Amazon Web Services General Reference.</string></p></blockquote><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>aws s3 <span class="nb">ls</span> <span class="nt">--endpoint-url</span> http://localhost:8080

An error occurred <span class="o">(</span>502<span class="o">)</span> when calling the ListBuckets operation <span class="o">(</span>reached max retries: 4<span class="o">)</span>: Bad Gateway
</pre></table></code></div></div><p>As we can observe <code class="language-plaintext highlighter-rouge">aws cli</code> has failed with request and 4 more retired requests. Same sequence of incoming invocations we can track on proxy instance: (<code class="language-plaintext highlighter-rouge">GET HTTP</code> incoming request and 4 retries. These are the requests made by <code class="language-plaintext highlighter-rouge">aws cli</code> over HTTP protocol.)</p><p><a href="/images/posts/aws-sigv4/mitmproxy_requests.png" class="popup img-link shimmer"><img src="/images/posts/aws-sigv4/mitmproxy_requests.png" alt="img_11.png" loading="lazy"></a></p><p>Let’s view them with more details:</p><p><a href="/images/posts/aws-sigv4/mitmp_r1.png" class="popup img-link shimmer"><img src="/images/posts/aws-sigv4/mitmp_r1.png" alt="img_11.png" loading="lazy"></a> <a href="/images/posts/aws-sigv4/mitmp_r2.png" class="popup img-link shimmer"><img src="/images/posts/aws-sigv4/mitmp_r2.png" alt="img_11.png" loading="lazy"></a> <a href="/images/posts/aws-sigv4/mitmp_r3.png" class="popup img-link shimmer"><img src="/images/posts/aws-sigv4/mitmp_r3.png" alt="img_11.png" loading="lazy"></a></p><h2 id="exploring-request-payload-in-details"><span class="me-2">Exploring request payload in details</span><a href="#exploring-request-payload-in-details" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>2023-07-16 13:47:57 GET http://localhost:8080/
                        ← Connection killed: Request destination unknown. Unable to figure out where this request should be forwarded to.
                              Request                                                             Response                                                              Detail
Host:                   localhost:8080
Accept-Encoding:        identity
User-Agent:             aws-cli/1.27.92 md/Botocore#1.31.2 ua/2.0 os/macos#21.6.0 md/arch#x86_64 lang/python#3.10.9 md/pyimpl#CPython cfg/retry-mode#legacy botocore/1.31.2
X-Amz-Date:             20230716T104757Z
X-Amz-Content-SHA256:   e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
Authorization:          AWS4-HMAC-SHA256 <span class="nv">Credential</span><span class="o">=</span>AKIA1111111111111111/20230716/us-east-1/s3/aws4_request, <span class="nv">SignedHeaders</span><span class="o">=</span>host<span class="p">;</span>x-amz-content-sha256<span class="p">;</span>x-amz-date,
                        <span class="nv">Signature</span><span class="o">=</span>7faebc25c8c5ea57e8a8565c7c145816fb9c9be5d3d5258a03613e4f75e36716
amz-sdk-invocation-id:  db19fb2e-221d-48b1-954e-9d31dbc097a4
amz-sdk-request:        <span class="nv">attempt</span><span class="o">=</span>1
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">aws-cli/1.27.92 md/Botocore#1.31.2</code> - as we can see <code class="language-plaintext highlighter-rouge">aws-cli</code> uses botocore 1.31.2 version and this is true, because <code class="language-plaintext highlighter-rouge">aws-cli</code> is written on Python and uses most popular botocore library to interact with AWS: <a href="https://github.com/aws/aws-cli">https://github.com/aws/aws-cli</a><li><code class="language-plaintext highlighter-rouge">X-Amz-Date: 20230716T104757Z</code> the date when request was made 16/07/2023 10:47:57<li><code class="language-plaintext highlighter-rouge">X-Amz-Content-SHA256: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855</code><li><code class="language-plaintext highlighter-rouge">Authorization: AWS4-HMAC-SHA256 Credential=AKIA1111111111111111/20230716/us-east-1/s3/aws4_request, SignedHeaders=host;x-amz-content-sha256;x-amz-date, Signature=7faebc25c8c5ea57e8a8565c7c145816fb9c9be5d3d5258a03613e4f75e36716</code> is dynamic (for each request <code class="language-plaintext highlighter-rouge">Signature</code> will be regenerated. It has time-based generation protection in algorithm) it contains <code class="language-plaintext highlighter-rouge">Credential=AKIA1111111111111111/20230716/us-east-1/s3/aws4_request</code> - this is our fake ACCESS_KEY, extracted date, region, service name and endpoint (we will see later code snippets of aws cli)<li><code class="language-plaintext highlighter-rouge">amz-sdk-invocation-id: db19fb2e-221d-48b1-954e-9d31dbc097a4</code> - is the same for this and all retry requests<li><code class="language-plaintext highlighter-rouge">amz-sdk-request: attempt=1</code> the attempt number. On further retry requests it will be in other format <code class="language-plaintext highlighter-rouge">attempt=4; max=5</code></ul><h2 id="according-to-latest-aws-cli-sources-the-following-sequence-is-applied-on-generating-signature-and-signing-the-request-before-sending-to-aws"><span class="me-2">According to latest aws-cli sources the following sequence is applied on generating <code class="language-plaintext highlighter-rouge">Signature</code> and signing the request before sending to AWS:</span><a href="#according-to-latest-aws-cli-sources-the-following-sequence-is-applied-on-generating-signature-and-signing-the-request-before-sending-to-aws" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><pre><code class="language-mermaid">flowchart TD
    A[modify_request_before_signing] --&gt; B[canonical_request]
    B --&gt; C[string_to_sign]
    C --&gt; D[inject_signature_to_request]
</code></pre><ul><li><code class="language-plaintext highlighter-rouge">canonical request</code> calculation:</ul><div class="language-http highlighter-rouge"><div class="code-header"> <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="err">'GET
/

host:localhost:8080
x-amz-content-sha256:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
x-amz-date:20230716T165206Z

host;x-amz-content-sha256;x-amz-date
e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855'
</span></pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">x-amz-content-sha256</code> is prepared using <code class="language-plaintext highlighter-rouge">sha256(request_body).hexdigest()</code> function</p><ul><li><code class="language-plaintext highlighter-rouge">string to sign</code> calculation:</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>'AWS4-HMAC-SHA256
20230716T165206Z
20230716/us-east-1/s3/aws4_request
e9294b9f0d3a4917e178edd1774e837c64145f3dd66aa46b4116a2f966e09d5d'
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">string_to_sign</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">canonical_request</span><span class="p">):</span>
        <span class="n">sts</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">AWS4-HMAC-SHA256</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">sts</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">])</span>
        <span class="n">sts</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">credential_scope</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
        <span class="n">sts</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">sha256</span><span class="p">(</span><span class="n">canonical_request</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)).</span><span class="nf">hexdigest</span><span class="p">())</span>
        <span class="k">return</span> <span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">sts</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">credential_scope</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scope</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">scope</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_region_name</span><span class="p">)</span>
        <span class="n">scope</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_service_name</span><span class="p">)</span>
        <span class="n">scope</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">'</span><span class="s">aws4_request</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">signature</code> calculation:</ul><p>To generate signature sign function applied (using SHA256 implementation) multiple times to <code class="language-plaintext highlighter-rouge">SECRET_KEY</code>, <code class="language-plaintext highlighter-rouge">DATE</code>, <code class="language-plaintext highlighter-rouge">REGION</code>, <code class="language-plaintext highlighter-rouge">SERVICE</code> and <code class="language-plaintext highlighter-rouge">string to sign</code></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    <span class="n">_sig</span> <span class="o">=</span> <span class="n">hmac</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">),</span> <span class="n">sha256</span><span class="p">).</span><span class="nf">hexdigest</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>'27b70dea39f1fddc4dd42d16c4cdd15fbce79dd82e72d33c2ea22d1e34072434'
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">signature</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">string_to_sign</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">credentials</span><span class="p">.</span><span class="n">secret_key</span>
        <span class="n">k_date</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_sign</span><span class="p">(</span>
            <span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">AWS4</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="sh">"</span><span class="p">).</span><span class="nf">encode</span><span class="p">(),</span> <span class="n">request</span><span class="p">.</span><span class="n">context</span><span class="p">[</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">k_region</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_sign</span><span class="p">(</span><span class="n">k_date</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">_region_name</span><span class="p">)</span>
        <span class="n">k_service</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_sign</span><span class="p">(</span><span class="n">k_region</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">_service_name</span><span class="p">)</span>
        <span class="n">k_signing</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_sign</span><span class="p">(</span><span class="n">k_service</span><span class="p">,</span> <span class="sh">'</span><span class="s">aws4_request</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_sign</span><span class="p">(</span><span class="n">k_signing</span><span class="p">,</span> <span class="n">string_to_sign</span><span class="p">,</span> <span class="nb">hex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></table></code></div></div><ul><li>the result request after _inject_signature_to_request applied:</ul><div class="language-http highlighter-rouge"><div class="code-header"> <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="err">User-Agent: aws-cli/1.27.160 Python/3.11.2 Darwin/21.6.0 botocore/1.29.154
X-Amz-Date: 20230716T165206Z
X-Amz-Content-SHA256: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
Authorization: AWS4-HMAC-SHA256 Credential=AKIA1111111111111111/20230716/us-east-1/s3/aws4_request, SignedHeaders=host;x-amz-content-sha256;x-amz-date, Signature=27b70dea39f1fddc4dd42d16c4cdd15fbce79dd82e72d33c2ea22d1e34072434
</span></pre></table></code></div></div><h2 id="key-takeaways"><span class="me-2">Key takeaways</span><a href="#key-takeaways" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>ACCESS_KEY is sent in every HTTP request in text-plain form in the header<li>SECRET_ACCESS_KEY is not send over the network. However, it is included in multiple rounds of hashing as one of many variables when preparing the <code class="language-plaintext highlighter-rouge">Signature</code> of request<li>Special hash is used to sign the request to exclude the possibility of request tampering</ul><blockquote class="prompt-tip"><p>To prevent tampering with a request while it’s in transit, some request elements are used to calculate a hash (digest) of the request, and the resulting hash value is included as part of the request. When an AWS service receives the request, it uses the same information to calculate a hash and matches it against the hash value in your request. If the values don’t match, AWS denies the request.</p></blockquote><ul><li>There is a datetime included during hash calculation, creating a window during which AWS is expecting the original request</ul><blockquote class="prompt-tip"><p>In most cases, a request must reach AWS within five minutes of the time stamp in the request. Otherwise, AWS denies the request.</p></blockquote><h2 id="references-links"><span class="me-2">References (Links):</span><a href="#references-links" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://github.com/aws/aws-cli">https://github.com/aws/aws-cli</a><li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_aws-signing.html">https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_aws-signing.html</a><li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-options.html">https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-options.html</a><li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/create-signed-request.html">https://docs.aws.amazon.com/IAM/latest/UserGuide/create-signed-request.html</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/aws/">aws</a>, <a href="/categories/iam/">iam</a>, <a href="/categories/security/">security</a>, <a href="/categories/sigv4/">sigv4</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/iam/" class="post-tag no-text-decoration" >iam</a> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/sigv4/" class="post-tag no-text-decoration" >sigv4</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Intercepting%20AWS%20CLI%20and%20SDK%20API%20calls%20with%20MITM%20proxy.%20How%20ACCESS_KEY%20and%20ACCESS_SECRET_KEY%20are%20applied.%20Signature%20Version%204%20Under%20the%20Hood.%20-%20Engineer's%20Notes&url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F07%2F16%2Fmitmproxy-hmac.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Intercepting%20AWS%20CLI%20and%20SDK%20API%20calls%20with%20MITM%20proxy.%20How%20ACCESS_KEY%20and%20ACCESS_SECRET_KEY%20are%20applied.%20Signature%20Version%204%20Under%20the%20Hood.%20-%20Engineer's%20Notes&u=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F07%2F16%2Fmitmproxy-hmac.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F07%2F16%2Fmitmproxy-hmac.html&text=Intercepting%20AWS%20CLI%20and%20SDK%20API%20calls%20with%20MITM%20proxy.%20How%20ACCESS_KEY%20and%20ACCESS_SECRET_KEY%20are%20applied.%20Signature%20Version%204%20Under%20the%20Hood.%20-%20Engineer's%20Notes" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftsypuk.github.io%2Fposts%2F2023%2F07%2F16%2Fmitmproxy-hmac.html" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/2025/09/26/multiagnet-n8n-bedrock.html">Orchestrating AI multi-agent infrastructure with AWS Bedrock, OpenAI and n8n</a><li class="text-truncate lh-lg"> <a href="/posts/2025/07/20/elastic-cache-vector.html">Amazon ElastiCache Redis as a Vector Embeddings Storage for Semantic Search in AWS Community Blog posts</a><li class="text-truncate lh-lg"> <a href="/posts/2025/09/17/duckdb-s3.html">Running analytics queries from your machine with Zero-BigData stack needed on top of AWS S3(compressed JSON, Parquet, csv) or other DataSources</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/02/dynamo-design.html">DynamoDB Table Design Principles - NoSQL Modeling</a><li class="text-truncate lh-lg"> <a href="/posts/2023/10/04/dynamo-one-to-many.html">DynamoDB Table Design Principles - One-To-Many Relationships in NoSQL</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/2023/06/24/api-gw-iam.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1687615200" data-df="ll" > Jun 24, 2023 </time><h4 class="pt-0 my-2">AWS API Gateway with AWS IAM authorization</h4><div class="text-muted"><p>Abstract AWS API Gateway is widely used in various integrations and architectures. One common use case for enhancing its authorization level is by incorporating an authorizer lambda or integrating ...</p></div></div></a></article><article class="col"> <a href="/posts/2024/02/11/system-manager.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1707660000" data-df="ll" > Feb 11, 2024 </time><h4 class="pt-0 my-2">AWS SSM Session Manager as secure Hub to establish multiple Connections to instances and Port Forwarding</h4><div class="text-muted"><p>Abstract Port forwarding or SSH tunnelling is technic widely used to map remote ports to a client machine with possibility of remapping. The data traffic is encrypted and transferred within SSH tu...</p></div></div></a></article><article class="col"> <a href="/posts/2023/02/08/aws-vpc-traffic-mirroring-ids-suricata.html" class="post-preview card h-100"><div class="card-body"> <time data-ts="1675850400" data-df="ll" > Feb 8, 2023 </time><h4 class="pt-0 my-2">AWS VPC traffic mirroring to IDS. Deep dive with Wireshark.</h4><div class="text-muted"><p>Abstract Traffic mirroring refers to the process of copying network traffic from one network port or interface to another for analysis, monitoring, or security purposes. There are multiple options...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/2023/06/24/api-gw-iam.html" class="btn btn-outline-primary" aria-label="Older" ><p>AWS API Gateway with AWS IAM authorization</p></a> <a href="/posts/2023/07/31/dynamo-import.html" class="btn btn-outline-primary" aria-label="Newer" ><p>Challenges with Transferring DynamoDB Table using native AWS DynamoDB Import/Export from S3. Implementing own importing tool.</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://www.linkedin.com/in/roman-tsypuk">Roman Tsypuk</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span> <span data-bs-toggle="tooltip" data-bs-placement="top" title="2025-09-26 20:11:52 +0300 &#013;be60bb44e6416aa69b8fd68791db025be40c523c">Build version: be60bb4</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/dynamodb/">dynamodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/s3/">s3</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecs/">ecs</a> <a class="post-tag btn btn-outline-primary" href="/tags/network/">network</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli/">cli</a> <a class="post-tag btn btn-outline-primary" href="/tags/fargate/">fargate</a> <a class="post-tag btn btn-outline-primary" href="/tags/firehose/">firehose</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'tsypuk/tsypuk.github.io', 'data-repo-id': 'R_kgDOIxaFiw', 'data-category': 'General', 'data-category-id': 'DIC_kwDOIxaFi84CUSfn', 'data-mapping': 'og:title', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'top', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
